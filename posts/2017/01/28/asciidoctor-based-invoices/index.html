<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Asciidoctor based invoices : Notepack</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Invoicing seem easy, so why shouldn't I do my own template with Asciidoctor and take it from there. Because, there are so many other things to do when you start your own company. : A randomized pack of notes">
    <link rel="canonical" href="http://jakub.marchwicki.pl/posts/2017/01/28/asciidoctor-based-invoices/">
    <link href="http://jakub.marchwicki.pl/feed.xml" rel="alternate" type="application/atom+xml" title="Notepack" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/foundation.css"/>
    <link rel="stylesheet" href="/css/coderay.css"/>
    <link rel="stylesheet" href="/css/asciidoctor.css"/>
    <script src="/js/vendor/modernizr.js"></script>    
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/foundicons/3.0.0/foundation-icons.min.css">

    <!-- Social -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@kubem">
    <meta property="og:type" content="website">

    
    <meta property="og:title"  content="Asciidoctor based invoices">
    <meta name="twitter:title" content="Asciidoctor based invoices">
    

    
    <meta name="twitter:description" content="Invoicing seem easy, so why shouldn't I do my own template with Asciidoctor and take it from there. Because, there are so many other things to do when you start your own company.">
    <meta property="og:description" content="Invoicing seem easy, so why shouldn't I do my own template with Asciidoctor and take it from there. Because, there are so many other things to do when you start your own company.">
        
    

        
    <!-- google analytics async -->
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-439480-4']);
    _gaq.push(['_trackPageview']);
    (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
    

</head>


    <body>

    <header class="site-header">

  <div class="wrap">

    <a class="site-title" href="/"><i class="fi-folder"></i>Notepack</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
           viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
          <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
            h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
            h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
            c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">      
        
          <a class="page-link" href="/posts/">All posts</a>
        
          <a class="page-link" href="/speaking/">All speaking</a>
        
          <a class="page-link" href="/consultancy/">Consultancy</a>
        
          <a class="page-link" href="/contact/">Contact</a>
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrap">
      <div class="post">

  <header class="post-header">
    <h1>Asciidoctor based invoices</h1>
    <p class="meta">Jan 28, 2017</p>
  </header>

  <article class="post-content">
  <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This is something I&#8217;ve been thinking for a while, but <a href="https://jezenthomas.com/how-i-write-invoices-in-vim/">this idea by Jezen</a> got me going. As Jezen nicely put it:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Since starting my own company back in April, I’ve had to piece together some fairly mundane business boilerplate, e.g., invoices, at the end of each month.</p>
</div>
<div class="paragraph">
<p>I think people typically use something from Microsoft Office for this, or maybe some online invoicing web application, but I’m quite happy to stay in the land of Vim for these tasks.</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="planning">Planning</h2>
<div class="sectionbody">
<div class="paragraph">
<div class="title">Requirements</div>
<p>Before I even started planning, I needed to figure out some essential information required on an invoice. This differs from county to country so the list is Poland specific (a I assume fairly overcomplicated compared to British or American invoices - well):</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10003; invoice date</p>
</li>
<li>
<p>&#10003; consecutive number, based on one or more series which genuinely identifies an invoice</p>
</li>
<li>
<p>&#10003; names of both seller and customer, with addresses and tax identification numbers (ie. VAT numbers)</p>
</li>
<li>
<p>&#10003; date when goods or services were delivered (or date of receiving money when the service was prepaid)</p>
</li>
<li>
<p>&#10003; name of goods or services</p>
</li>
<li>
<p>&#10003; quantity (together with a measure - like a single piece)</p>
</li>
<li>
<p>&#10003; unit price</p>
</li>
<li>
<p>&#10003; discounts (if applicable or not included in the unit price)</p>
</li>
<li>
<p>&#10003; the overall value of goods or services (without taxes); unit price <em>times</em> quantity</p>
</li>
<li>
<p>&#10003; VAT tax rate</p>
</li>
<li>
<p>&#10003; the overall net value (all positions), divided by the tax rates</p>
</li>
<li>
<p>&#10003; the overall tax amount (all positions), divided by the tax rates</p>
</li>
<li>
<p>&#10003; the overall-overall (so everything)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Whew - pretty complex. However, for the sake of my own invoices, where I always have a single position with a single tax rate - there is a chance I can simplify it a bit.</p>
</div>
<div class="paragraph">
<div class="title">Ingredients</div>
<p>When done with the <em>requirements</em> I can finally start doing the fun stuff - playing with Asciidoctor. I&#8217;ve split my work into few steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Asciidoctor template</strong>: an <code>.adoc</code> file with the structure of the document <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</sup></p>
</li>
<li>
<p><strong>Styling</strong>: I only needed a PDF, so Asciidoctor PDF theming guide <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnote_2" title="View footnote.">2</a>]</sup></p>
</li>
<li>
<p><strong>Source files</strong>: easy consumable, human readable files with invoice details</p>
</li>
<li>
<p><strong>Runner</strong>: a groovy script to glue it all together and run the thing</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="implementation">Implementation</h2>
<div class="sectionbody">
<div class="paragraph">
<div class="title">Source files</div>
<p>I&#8217;ve started with a draft of source file, which was YAML in my case. With a structure more or less like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">invoice-number</span>: <span class="string"><span class="content">FV/0001/2017</span></span>
<span class="key">status</span>: <span class="string"><span class="content">paid</span></span>
<span class="key">date</span>: <span class="string"><span class="content">2017-01-31</span></span>
<span class="key">due-date</span>: <span class="string"><span class="content">2017-02-06</span></span>
<span class="key">client</span>: <span class="string"><span class="delimiter">|</span><span class="content">
  My Precious customer
  TAX nb: 123456789</span></span>
<span class="key">positions</span>:
  - <span class="string"><span class="content">element: Writing lot of code</span></span>
    <span class="key">quantity</span>: <span class="string"><span class="content">1</span></span>
    <span class="key">unit-price</span>: <span class="string"><span class="content">100</span></span>
    <span class="key">tax</span>: <span class="string"><span class="content">23%</span></span>
<span class="key">notes</span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is obviously not enough for an invoice to be complete (especially under polish law regulations). So I needed some additional logic to calculate sums, amounts, parse dates etc.</p>
</div>
<div class="paragraph">
<div class="title">Groovy runner</div>
<p>I went with Groovy. Under no means I&#8217;m a Groovy expert, but there were a few quick wins with Groovy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>frictionless dependency management (with <a href="http://docs.groovy-lang.org/latest/html/documentation/grape.html">grapes</a>),</p>
</li>
<li>
<p>integration with Asciidoctor (through asciidoctorj),</p>
</li>
<li>
<p>ability to run everything in the command line through a single file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While Asciidoctor is Ruby based and Rake might have seemed natural - I&#8217;m even worse at  Ruby.</p>
</div>
<div class="paragraph">
<p>The script has grown up to 150 lines of code; more that I&#8217;ve expected - but that&#8217;s mostly because I&#8217;m not very proficient with Groovy syntactic sugar. That&#8217;s also the reason why I&#8217;m not sharing the script - I need to work on that.</p>
</div>
<div class="paragraph">
<p>Calling Asciidoctor from Groovy is actually dead simple.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Invoice invoiceData = Invoice.fromFile(inputFile) <b class="conum">(1)</b>

<span class="keyword">def</span> attributes = attributes()
        .attribute(<span class="string"><span class="delimiter">'</span><span class="content">pdf-stylesdir</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">template/themes</span><span class="delimiter">'</span></span>)
        .attribute(<span class="string"><span class="delimiter">'</span><span class="content">pdf-style</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">basic.yml</span><span class="delimiter">'</span></span>)  <b class="conum">(2)</b>
        .attribute(<span class="string"><span class="delimiter">'</span><span class="content">nofooter</span><span class="delimiter">'</span></span>)
        .attributes(invoiceData.asMap)
        .asMap()

Asciidoctor asciidoctor = create()
asciidoctor.convertFile(
        <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">'</span><span class="content">template/template.adoc</span><span class="delimiter">'</span></span>), <b class="conum">(3)</b>
        options()
          .attributes(attributes)
          .toFile(Paths.get(<span class="string"><span class="delimiter">'</span><span class="content">build</span><span class="delimiter">'</span></span>, outputFile).toFile())
          .backend(<span class="string"><span class="delimiter">'</span><span class="content">pdf</span><span class="delimiter">'</span></span>)
          .get())</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This is where I load YAML into a map-like structure</p>
</li>
<li>
<p>Slight enhancements to the basic asciidoctor-pdf theme</p>
</li>
<li>
<p>Invoking actual conversion based on my template file.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Rest of the script was validating the input and some (most) of additional logic related to calculating different values required on the invoice.</p>
</div>
<div class="paragraph">
<div class="title">Asciidoctor template</div>
<p>Initially the template sounded fairly simple, though there is a number of Asciidoctor and asciidotor-pdf design decisions (or limitations) which needed workarounds. These included more complex attributes types (like lists / maps) or elements positioning in PDF (align to right).</p>
</div>
<div class="paragraph">
<p>Therefore, some parts of the template looked a weird, like this one.</p>
</div>
<div class="listingblock">
<div class="title">Mitigating lack of loop-control</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="txt">ifdef::position-0-element[]
| {position-0-element}
| {position-0-quantity} szt
| {position-0-unit-price}
| {position-0-position-total}
| {position-0-position-tax}
| {position-0-position-total-gross}
| {position-0-tax}
endif::[]

ifdef::position-1-element[]
| {position-1-element}
| {position-1-quantity} szt
| {position-1-unit-price}
| {position-1-position-total}
| {position-1-position-tax}
| {position-1-position-total-gross}
| {position-1-tax}
endif::[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>I wrote it already: most of my invoiced have a single position and a single tax rate, which makes my life a bit easier and I didn&#8217;t need to make the template too generic.</p>
</div>
<div class="paragraph">
<p>There were also few issues with including subsections, defining attributes within a template etc. Asciidoctor-pdf is still in <em>alpha</em> phase and I can imagine I&#8217;ve stretched it a bit to its limits. I&#8217;ve promised myself to document it with example and see how it should really work.</p>
</div>
<div class="paragraph">
<div class="title">Theming</div>
<p>That&#8217;s actually one of the most awesome parts of asciidoctor-pdf: a YAML file which defines a number of attributes impacting the look and feel of the PDF. Changing fonts, sizes, colors as easy as 1-2-3 and neatly detailed in the theming guide <sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnote_3" title="View footnote.">3</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>That was a huge win!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="so-why-i-ve-done-it">So why I&#8217;ve done it?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I could&#8217;ve used one of millions invoicing software (offered even for free, in the cloud). True.</p>
</div>
<div class="paragraph">
<p>But I didn&#8217;t. I had a funny and geeky evening exploring the ecosystem of Asciidoctor. It was definitely worth it! And must admit, I like the final results.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/2017-01-28-asciidoctor-based-invoices-8a844.png" alt="2017 01 28 asciidoctor based invoices 8a844">
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. <a href="http://asciidoctor.org/docs/user-manual/" class="bare">http://asciidoctor.org/docs/user-manual/</a>
</div>
<div class="footnote" id="_footnote_2">
<a href="#_footnoteref_2">2</a>. <a href="https://github.com/asciidoctor/asciidoctor-pdf/" class="bare">https://github.com/asciidoctor/asciidoctor-pdf/</a>
</div>
<div class="footnote" id="_footnote_3">
<a href="#_footnoteref_3">3</a>. <a href="https://github.com/asciidoctor/asciidoctor-pdf/blob/master/docs/theming-guide.adoc" class="bare">https://github.com/asciidoctor/asciidoctor-pdf/blob/master/docs/theming-guide.adoc</a>
</div>
</div>
  </article>

  
	<div id="disqus_thread"></div>
	<script type="text/javascript">
	    /* * * CONFIGURATION VARIABLES * * */
	    var disqus_shortname = 'jakubblog';
	    

	    /* * * DON'T EDIT BELOW THIS LINE * * */
	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();
	</script>
	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

  
</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrap">

    <div class="column">
      <ul  style="margin-bottom: 0 !important">
        
          
          <li><a href="/posts/">
            <span class="icon foundation-icon"><i class="fi-page-multiple"></i></span>
            <span class="username">All posts</span>
            </a>
          </li>
          
        
          
          <li><a href="/speaking/">
            <span class="icon foundation-icon"><i class="fi-microphone"></i></span>
            <span class="username">All speaking</span>
            </a>
          </li>
          
        
          
          <li><a href="/consultancy/">
            <span class="icon foundation-icon"><i class="fi-comments"></i></span>
            <span class="username">Consultancy</span>
            </a>
          </li>
          
        
          
          <li><a href="/contact/">
            <span class="icon foundation-icon"><i class="fi-address-book"></i></span>
            <span class="username">Contact</span>
            </a>
          </li>
          
        
      </ul>
      <ul>
        <li>
          <a href="https://github.com/kubamarchwicki">
            <span class="icon foundation-icon"><i class="fi-social-github"></i></span>
            <span class="username">kubamarchwicki</span>
          </a>
        </li>
        <li>
          <a href="https://twitter.com/kubem">
            <span class="icon foundation-icon"><i class="fi-social-twitter"></i></span>
            <span class="username">kubem</span>
          </a>
        </li>
        <li>
          <a href="https://www.linkedin.com/in/kubamarchwicki">
            <span class="icon foundation-icon"><i class="fi-social-linkedin"></i></span>
            <span class="username">kubamarchwicki</span>
          </a>
        </li>
      </ul>
    </div>

  </div>

</footer>


    <script src="/js/vendor/jquery.js"></script>
    <script src="/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
    </script>
    <script src="/js/vendor/jquery.js"></script>
    <script src="/js/foundation/foundation.js"></script>
    <script>
      $(document).foundation();
      var doc = document.documentElement;
      doc.setAttribute('data-useragent', navigator.userAgent);
    </script>

    </body>
</html>