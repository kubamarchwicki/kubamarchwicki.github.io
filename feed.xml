<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Notepack</title>
    <description>A randomized pack of notes</description>
    <link>http://jakub.marchwicki.pl/</link>
    <atom:link href="http://jakub.marchwicki.pl/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>Fri, 05 Jun 2015 17:32:07 +0000</pubDate>
    <lastBuildDate>Fri, 05 Jun 2015 17:32:07 +0000</lastBuildDate>
    <generator>Jekyll v2.4.0</generator>
    
      <item>
        <title>Wrapping Maven distribution together with a project</title>
        <description>&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;There are few things that I&amp;#8217;ve been missing in Maven, that are available in Gradle out of the box (and no, I don&amp;#8217;t want to start a holy Gradle vs. Maven war). One of those was a Gradle wrapper; I wanted to create projects which are pretty environment agnostic and download whatever needed straight form the internet. While the build and dependency management tools do their job I was always struggling with the dependency management itself. Until now.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;but-why&quot;&gt;But why?&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Yeah - good question. Why on Earth would I need to have a dependency management tool as a &#39;compile time&#39; dependency. In my particular case it was Jenkins fault, I wanted my continuous integration environment to be just an infrastructure: an operating system, latest Java installation, Git - and the project brings what&amp;#8217;s ever required by itself. That is keeping the CI infrastructure robust with minimal project specific dependencies.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;I remember &#39;good old times&#39; when certain project had to be built on particular swarms due to concrete Maven version being present or some system libraries being pre-installed. This approach doesn&amp;#8217;t scale and I was eager to fix it.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;maven-wrapper&quot;&gt;Maven wrapper&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;While the wrapper isn&amp;#8217;t a problem for Gradle, my Maven projects were still problematic. Until I found a &lt;strong&gt;maven-wrapper&lt;/strong&gt; - a copy of the Gradle wrapper ported for use with Apache Maven.
&lt;span class=&quot;footnote&quot; id=&quot;_footnote_maven-wrapper&quot;&gt;[&lt;a id=&quot;_footnoteref_1&quot; class=&quot;footnote&quot; href=&quot;#_footnote_1&quot; title=&quot;View footnote.&quot;&gt;1&lt;/a&gt;]&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;As described on the project&amp;#8217;s wiki:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;quoteblock&quot;&gt;
&lt;blockquote&gt;
the Maven Command Line Wrapper will auto-download and install Apache Maven from the Internet and then run your Maven goals.
&lt;/blockquote&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;If you are ok with manual installation, all that&amp;#8217;s needed is copying &lt;code&gt;mvnw&lt;/code&gt; files and &lt;code&gt;maven&lt;/code&gt; folder to your project - from say an example project.
&lt;span class=&quot;footnote&quot; id=&quot;_footnote_maven-wrapper-example&quot;&gt;[&lt;a id=&quot;_footnoteref_2&quot; class=&quot;footnote&quot; href=&quot;#_footnote_2&quot; title=&quot;View footnote.&quot;&gt;2&lt;/a&gt;]&lt;/span&gt;
This will make the file structure look pretty much like this.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code&gt;sample
 ├── maven
 │   ├── maven-wrapper.jar
 │   └── maven-wrapper.properties
 ├── src
 │   └── main
 │       └── java
 ├── mvnw
 ├── mvnw.bat
 └── pom.xml&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Now instead of running &lt;code&gt;mvn clean install&lt;/code&gt; we can just go with &lt;code&gt;./mvnw clean install&lt;/code&gt; that will do the thing.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;From my perspective that was quite handy - I didn&amp;#8217;t have to maintain a particular version of Maven in my CI environment. I had it defined together with a project. A first little success.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;automate-all-the-things&quot;&gt;Automate all the things&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Coping files is so nineties, so the next step would be to automatically get the wrapper through the Maven build process. This sounded reasonable, cause as the developer I obviously had Maven installed locally and the wrapper was targeting the continuous integration builds, not developers&#39; machines.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Nothing easier, the Maven wrapper comes with a handy build plugin.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;plugin&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;tag&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.rimerosolutions.maven.plugins&lt;span class=&quot;tag&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;tag&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;wrapper-maven-plugin&lt;span class=&quot;tag&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;tag&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;0.0.4&lt;span class=&quot;tag&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;tag&quot;&gt;&amp;lt;configuration&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;tag&quot;&gt;&amp;lt;mavenVersion&amp;gt;&lt;/span&gt;3.3.1&lt;span class=&quot;tag&quot;&gt;&amp;lt;/mavenVersion&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/configuration&amp;gt;&lt;/span&gt;
&lt;span class=&quot;tag&quot;&gt;&amp;lt;/plugin&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Running &lt;code&gt;mvn wrapper:wrapper&lt;/code&gt; does the job and the wrapper is installed.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;problems&quot;&gt;Problems?&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;That worked like a charm for a simple (very simple) project, a single project. But hey! we are doing enterprise here - our projects&#39; structure is hardly ever flat!&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;So if my project gets slightly more complicated (with submodules), the Maven wrapper tasks, defined on the parent project - is repeated for each and every module. The output gets cumbersome and far from ideal.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;xml&quot;&gt;sample
 ├── maven
 │   ├── maven-wrapper.jar
 │   └── maven-wrapper.properties
 ├── module
 |   ├── maven
 │   |   ├── maven-wrapper.jar
 │   |   └── maven-wrapper.properties
 |   ├── mvnw
 |   ├── mvnw.bat
 |   └── pom.xml
 ├── module2
 |   ├── maven
 │   |   ├── maven-wrapper.jar
 │   |   └── maven-wrapper.properties
 |   ├── mvnw
 |   ├── mvnw.bat
 |   └── pom.xml
 ├── mvnw
 ├── mvnw.bat
 └── pom.xml&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;I see a &lt;code&gt;MavenWrappersOverflowException&lt;/code&gt;. However, as this is purely related to the Maven life cycle and parent-child relationship (&#39;mother issues&#39; everywhere) - this is fixable with the configuration itself.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;plugin&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;tag&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.rimerosolutions.maven.plugins&lt;span class=&quot;tag&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;tag&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;wrapper-maven-plugin&lt;span class=&quot;tag&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;tag&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;0.0.4&lt;span class=&quot;tag&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;tag&quot;&gt;&amp;lt;inherited&amp;gt;&lt;/span&gt;false&lt;span class=&quot;tag&quot;&gt;&amp;lt;/inherited&amp;gt;&lt;/span&gt;        &lt;b class=&quot;conum&quot;&gt;(1)&lt;/b&gt;
    &lt;span class=&quot;tag&quot;&gt;&amp;lt;configuration&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;tag&quot;&gt;&amp;lt;mavenVersion&amp;gt;&lt;/span&gt;3.3.1&lt;span class=&quot;tag&quot;&gt;&amp;lt;/mavenVersion&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/configuration&amp;gt;&lt;/span&gt;
&lt;span class=&quot;tag&quot;&gt;&amp;lt;/plugin&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;colist arabic&quot;&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;By default, plugin configuration should be propagated to child POMs, so to break the inheritance, you could uses the &lt;code&gt;&amp;lt;inherited&amp;gt;&lt;/code&gt; tag&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Now, we just need to run the goal for this particular project (while in the parent project&amp;#8217;s folder). This will generated the wrapper only where it&amp;#8217;s needed.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;bash&quot;&gt;mvn wrapper:wrapper -N         &lt;b class=&quot;conum&quot;&gt;(1)&lt;/b&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;colist arabic&quot;&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;The &lt;code&gt;-N&lt;/code&gt; argument stands for non-recursive builds, which prevents Maven from building submodules (only builds the project contained in the current directory).&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Just one thing: with the wrapper plugin and Polyglot for Maven
&lt;span class=&quot;footnote&quot; id=&quot;_footnote_polyglot-maven&quot;&gt;[&lt;a id=&quot;_footnoteref_3&quot; class=&quot;footnote&quot; href=&quot;#_footnote_3&quot; title=&quot;View footnote.&quot;&gt;3&lt;/a&gt;]&lt;/span&gt;
I&amp;#8217;ve gradually lost interest in any other build tools ;-)&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;div class=&quot;footnote&quot; id=&quot;_footnote_1&quot;&gt;
&lt;a href=&quot;#_footnoteref_1&quot;&gt;1&lt;/a&gt; &lt;a href=&quot;https://github.com/rimerosolutions/maven-wrapper&quot; class=&quot;bare&quot;&gt;https://github.com/rimerosolutions/maven-wrapper&lt;/a&gt;
&lt;/div&gt;
&lt;div class=&quot;footnote&quot; id=&quot;_footnote_2&quot;&gt;
&lt;a href=&quot;#_footnoteref_2&quot;&gt;2&lt;/a&gt; &lt;a href=&quot;https://github.com/rimerosolutions/maven-wrapper-example&quot; class=&quot;bare&quot;&gt;https://github.com/rimerosolutions/maven-wrapper-example&lt;/a&gt;
&lt;/div&gt;
&lt;div class=&quot;footnote&quot; id=&quot;_footnote_3&quot;&gt;
&lt;a href=&quot;#_footnoteref_3&quot;&gt;3&lt;/a&gt; &lt;a href=&quot;https://github.com/takari/polyglot-maven&quot; class=&quot;bare&quot;&gt;https://github.com/takari/polyglot-maven&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
        <pubDate>Thu, 04 Jun 2015 00:00:00 +0000</pubDate>
        <link>http://jakub.marchwicki.pl/posts/2015/06/04/maven-wrapper/</link>
        <guid isPermaLink="true">http://jakub.marchwicki.pl/posts/2015/06/04/maven-wrapper/</guid>
        
        
        <category>posts</category>
        
      </item>
    
      <item>
        <title>Characterize your legacy with junit</title>
        <description>&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;This is a blog post with is a longer read to my &lt;a href=&quot;http://2015.tdd.geecon.org/&quot;&gt;GeeCON TDD 2015&lt;/a&gt; lightning talk presentation: &lt;a href=&quot;/speaking/2015/01/30/geecon-tdd/&quot;&gt;Characterize your legacy with jUnit Rules&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;what-are-characterization-tests-and-why-cared&quot;&gt;What are characterization tests and why cared?&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;div class=&quot;title&quot;&gt;Context&lt;/div&gt;
&lt;p&gt;I&amp;#8217;ve recently was involved in a project of upgrading our internal, vendor provided, not supported anymore HR application.
As we&amp;#8217;ve been refactoring one of our internal systems (upgrade from Rails 1.8 to 3.0) - it impacted a few systems nearby. Mostly due to the way Rails handled SOAP web services, which were the basis of the integration; the WSDL needed changing significantly and thus needed the HR system client classes.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;The whole idea was to replace existing axis stubs with new classes, keeping the interfaces backwards compatible. Rather simple task but not in this context: the app appeared to be a Java JSP web application with literally 10 class files and hundreds of JSP files with tons of logic in it (500+ lines per each JSP was a standard). A Java application in a bad PHP style.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;What is more, this was type of integration where the order of parameters in the SOAP call were important; imagine how brittle and fragile that was.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;While that looked fairly simple on paper (or diagram) the reality was much harder.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;imageblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;img src=&quot;data:image/png;base64,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&quot; alt=&quot;A context diagram&quot; width=&quot;690&quot; height=&quot;294&quot;&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;div class=&quot;title&quot;&gt;How to proceed&lt;/div&gt;
&lt;p&gt;From the application logs (around 150MB per week, as nobody though of turning of global DEBUG in log4j.properties) I could be able to figure out what classes were responsible for the web service communication - that was the starting point.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;The plan was to adhere to keep it working principle:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;extract the classes into a single jar&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;replace the classes with a lib&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;replace the lib with a new stub and client&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Few simple tasks to do. But what bothered me was how to make sure that the data structures before and after the changes are still the same.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;div class=&quot;title&quot;&gt;Actual tests&lt;/div&gt;
&lt;p&gt;This is when I was started with characterization tests (the golden master). I needed to describe the existing application and after each step, test the changes against the model (my benchmark). Hence, the flow looked pretty much like this:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;analyze the class / method in subject, gain the conceptual understanding&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;invoke the method within tests&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;log complete output / compare the output with existing log output&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;When the tests went green - I felt much safer. I know this is far from ideal testing method, but at least it has given a little of confidence in the baby steps I was making.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;where-to-start&quot;&gt;Where to start&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Ok, that was theory. Question is how to actually implement such test; recordings and assertions. The whole thing is actually pretty damn easy, especially with the last releases of JUnit. We will be leveraging Rule (ClassRule annotation to be precise) and the whole concept of TestRules.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;not-the-real-example&quot;&gt;Not the real example&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;I&amp;#8217;ll not drive through the actual code, as it was damn bad and will just make the point harder to understand. To give you a clue, here is a sample of the real production code (that was how the webservice was actually code - straight from the JSP file!)&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;jsp&quot;&gt;&amp;lt;%-- MAIN FRAME --%&amp;gt;

&amp;lt;div style=&#39;width:100%; height:344px; display: block&#39; id=&amp;quot;mainmenu_ifr&amp;quot;&amp;gt;
&amp;lt;table border=&#39;0&#39; cellspacing=&#39;0&#39; cellpadding=&#39;0&#39; width=&#39;100%&#39; style=&amp;quot;margin-top:15px;&amp;quot;&amp;gt;
&amp;lt;tr&amp;gt;
&amp;lt;td valign=&#39;top&#39; width=&amp;quot;200&amp;quot; align=&amp;quot;center&amp;quot;&amp;gt;

&amp;lt;%
String prac_pnr =(String)session.getAttribute(&amp;quot;prac_pnr&amp;quot;);
if (prac_pnr ==null) prac_pnr =&amp;quot;&amp;quot;;


YdpPssClient client = new YdpPssClient();
String key=&amp;quot;&amp;quot;;
String logaid=prac_pnr;
String mode=&amp;quot;small&amp;quot;;
LAOSL1.setPP_LANG(langs[lang]);
LAOSL1.setPP_NSP(user_nsp);
LAOSL1.setPP_NRZK(user_nrzk);
LAOSL1.setPP_PNR(loga_pnr);
Manager.refresh(LAOSL1,(String)session.getAttribute(&amp;quot;AdeliaKeyPoolName&amp;quot;));
%&amp;gt;

&amp;lt;%@ page import=&amp;quot;org.apache.axis.encoding.Base64&amp;quot; %&amp;gt;
&amp;lt;%
String encoded = Base64.encode(client.getUserFotoFromWServices(key,logaid,mode));
%&amp;gt;

&amp;lt;% if(encoded!= null) { %&amp;gt;
  &amp;lt;IMG src=&amp;quot;data:image/png;base64,&amp;lt;%=encoded%&amp;gt;&amp;quot; border=&amp;quot;0&amp;quot; id=&amp;quot;test&amp;quot;&amp;gt;
&amp;lt;% }else{ %&amp;gt;
  &amp;lt;IMG height=&amp;quot;177&amp;quot; src=&amp;quot;pics/noImage.jpg&amp;quot; border=&amp;quot;0&amp;quot; id=&amp;quot;test&amp;quot;&amp;gt;
&amp;lt;% } %&amp;gt;
&amp;lt;/td&amp;gt;
&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;To skip such convoluted code I&amp;#8217;ll use a more simple (simplistic) example- our legacy method is doing just string split and return the frist token.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;java&quot;&gt;&lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;BusinessClass&lt;/span&gt; {

  &lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;predefined-type&quot;&gt;String&lt;/span&gt; businessMethod(&lt;span class=&quot;predefined-type&quot;&gt;String&lt;/span&gt; param) {
    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; param.split(&lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt; &lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;)[&lt;span class=&quot;integer&quot;&gt;0&lt;/span&gt;];
  }

}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;And the test we will be using (actually in this case it&amp;#8217;s more like a runner than the fully blown test).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;java&quot;&gt;&lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;BusinessClassTest&lt;/span&gt; {

  &lt;span class=&quot;annotation&quot;&gt;@ClassRule&lt;/span&gt;
  &lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;directive&quot;&gt;static&lt;/span&gt; CharacterizationRule rule =
      aRuleFor(BusinessClassTest.class)
      .build();

  &lt;span class=&quot;directive&quot;&gt;private&lt;/span&gt; BusinessClass service = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; BusinessClass();

  &lt;span class=&quot;annotation&quot;&gt;@Test&lt;/span&gt;
  &lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;void&lt;/span&gt; just_run_the_method() {
    &lt;span class=&quot;directive&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;predefined-type&quot;&gt;String&lt;/span&gt; param = &lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;first parameter&lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;predefined-type&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;param = &lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt; + param);
    &lt;span class=&quot;predefined-type&quot;&gt;String&lt;/span&gt; output = service.businessMethod(param);
    &lt;span class=&quot;predefined-type&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;after split = &lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt; + output);
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;As you probably noticed, there are no assertions in the test. That&amp;#8217;s is deliberate - we are not asserting, because we probably don&amp;#8217;t have a clue what should be the desired outcome. What we do, is logging some output without drilling into the details.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;The whole idea is to log as much as possible and use the log as the feedback is the behaviour of the class (output) is not changing. This is what Michael Feathers described as characterization test.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;quoteblock&quot;&gt;
&lt;blockquote&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;A characterization test is a mean to describe (characterize) the actual behavior of an existing piece of software.&lt;/p&gt;
&lt;/div&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;attribution&quot;&gt;
&amp;#8212; Michael Feathers&lt;br&gt;
&lt;cite&gt;Working Effectively with Legacy Code&lt;/cite&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;the-working-example&quot;&gt;The working example&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;So, we see we need two modes for our tests: logging and verification. We should have exacly the same test code which can be run in two modes; collect all possible output and verify if the output is still the same. My approach would be to use an environment variable (flag) and pass it over during test invocation.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;java&quot;&gt;&lt;span class=&quot;directive&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;directive&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;predefined-type&quot;&gt;String&lt;/span&gt; ENV_NAME_FOR_RECORDING = &lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;pinchpoint&lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;;

&lt;span class=&quot;directive&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;boolean&lt;/span&gt; isRecording() {
  &lt;span class=&quot;predefined-type&quot;&gt;String&lt;/span&gt; env = &lt;span class=&quot;predefined-type&quot;&gt;System&lt;/span&gt;.getProperty(ENV_NAME_FOR_RECORDING);
  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (env != &lt;span class=&quot;predefined-constant&quot;&gt;null&lt;/span&gt;);
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;shell&quot;&gt;mvn test -Dpinchpoint=true -Dtest=BusinessCodeTest&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;div class=&quot;title&quot;&gt;The logging part&lt;/div&gt;
&lt;p&gt;I&amp;#8217;ve written at the beginning we will be using junit rules to get the stuff done. Since version 4.7 jUnit provides rules, which are smarter runners - that can perform additional actions during test (think of aspects or interceptor). &lt;code&gt;External Resource&lt;/code&gt; is one of such classes&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;quoteblock&quot;&gt;
&lt;blockquote&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;A base class for Rules that set up an external resource before a test and tear it down afterward.&lt;/p&gt;
&lt;/div&gt;
&lt;/blockquote&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;The actual logging, that save the complete output to a default temp folder, to a file named after the class undergoing the test, logging might look like so.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;java&quot;&gt;&lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;FileOutputCapture&lt;/span&gt; &lt;span class=&quot;directive&quot;&gt;extends&lt;/span&gt; ExternalResource {

  &lt;span class=&quot;directive&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;void&lt;/span&gt; before() &lt;span class=&quot;directive&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;predefined-type&quot;&gt;Throwable&lt;/span&gt; {
    original = &lt;span class=&quot;predefined-type&quot;&gt;System&lt;/span&gt;.out;
    &lt;span class=&quot;predefined-type&quot;&gt;PrintStream&lt;/span&gt; pos = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;predefined-type&quot;&gt;PrintStream&lt;/span&gt;(capturedStream);
    &lt;span class=&quot;predefined-type&quot;&gt;System&lt;/span&gt;.setOut(pos); &lt;b class=&quot;conum&quot;&gt;(1)&lt;/b&gt;
  }

  &lt;span class=&quot;directive&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;void&lt;/span&gt; after() {
    &lt;span class=&quot;predefined-type&quot;&gt;System&lt;/span&gt;.setOut(original);    &lt;b class=&quot;conum&quot;&gt;(2)&lt;/b&gt;
    &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; {
      Files.write(outputFile.toPath(),
      capturedStream.toByteArray(),
      StandardOpenOption.APPEND);   &lt;b class=&quot;conum&quot;&gt;(3)&lt;/b&gt;
    } &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;exception&quot;&gt;IOException&lt;/span&gt; e) {
      &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;exception&quot;&gt;RuntimeException&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;File write failed! &lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;, e);
    }
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;colist arabic&quot;&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Sustitute the standard &lt;code&gt;System.out&lt;/code&gt; with a stream to capturing all output&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Restore the original &lt;code&gt;PrintStream&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Write everything to file&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;div class=&quot;title&quot;&gt;The verification part&lt;/div&gt;
&lt;p&gt;Now that we are good with the log, we can start refactoring the &lt;code&gt;BusinessClass&lt;/code&gt; and do the verification if the output has changed in any way. Obviously, we would need another capture, without saving to a file.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;java&quot;&gt;&lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;StreamOutputCapture&lt;/span&gt; &lt;span class=&quot;directive&quot;&gt;extends&lt;/span&gt; ExternalResource {
  &lt;span class=&quot;predefined-type&quot;&gt;PrintStream&lt;/span&gt; original;

  &lt;span class=&quot;directive&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;void&lt;/span&gt; before() &lt;span class=&quot;directive&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;predefined-type&quot;&gt;Throwable&lt;/span&gt; {
    original = &lt;span class=&quot;predefined-type&quot;&gt;System&lt;/span&gt;.out;
    &lt;span class=&quot;predefined-type&quot;&gt;PrintStream&lt;/span&gt; pos = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;predefined-type&quot;&gt;PrintStream&lt;/span&gt;(capturedStream);
    &lt;span class=&quot;predefined-type&quot;&gt;System&lt;/span&gt;.setOut(pos);
  }

  &lt;span class=&quot;directive&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;void&lt;/span&gt; after() {
    &lt;span class=&quot;predefined-type&quot;&gt;System&lt;/span&gt;.setOut(original);
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Next thing is verification. Again, we will use jUnit goodies, this time a &lt;code&gt;Verifier&lt;/code&gt; class&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;quoteblock&quot;&gt;
&lt;blockquote&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Verifier is a base class for Rules like ErrorCollector, which turns passing test methods into failing tests if a verification check is failed&lt;/p&gt;
&lt;/div&gt;
&lt;/blockquote&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;java&quot;&gt;&lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;CaptureVerifier&lt;/span&gt; &lt;span class=&quot;directive&quot;&gt;extends&lt;/span&gt; Verifier {

  &lt;span class=&quot;directive&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;void&lt;/span&gt; verify() &lt;span class=&quot;directive&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;predefined-type&quot;&gt;Throwable&lt;/span&gt; {
    &lt;span class=&quot;predefined-type&quot;&gt;List&lt;/span&gt;&amp;lt;&lt;span class=&quot;predefined-type&quot;&gt;String&lt;/span&gt;&amp;gt; actual = ReadLines.fromStream(capturedStream);
    &lt;span class=&quot;predefined-type&quot;&gt;List&lt;/span&gt;&amp;lt;&lt;span class=&quot;predefined-type&quot;&gt;String&lt;/span&gt;&amp;gt; original = ReadLines.fromFile(pinchFile);

    &lt;span class=&quot;predefined-type&quot;&gt;Patch&lt;/span&gt;&amp;lt;&lt;span class=&quot;predefined-type&quot;&gt;String&lt;/span&gt;&amp;gt; patch = DiffUtils.diff(original, actual);

    assertThat(patch, is(empty()));
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;And if something went wrong, we get a nice feedback.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;txt&quot;&gt;java.lang.AssertionError:
File:
  &amp;lt;/tmp/com.example.BusinessClassTest.txt&amp;gt;
read with charset &amp;lt;UTF-8&amp;gt; does not have the expected content:
line: &amp;lt;3&amp;gt;, expected:&amp;lt;something&amp;gt; but was:&amp;lt;something else&amp;gt;
      at com.example.BusinessClassTest.should_create_master_output_file&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;instead-of-summary&quot;&gt;Instead of summary&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;The code snippets above is not the actual implementation. These are samples, to give a clue what&amp;#8217;s happening in the code. If you find this useful or interesting in any way, take a look on the actual &lt;a href=&quot;https://github.com/kubamarchwicki/junit-characterization&quot;&gt;implementation on Github&lt;/a&gt; or use it directly in your project.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;tag&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;pl.marchwicki&lt;span class=&quot;tag&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;tag&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;junit-characterization&lt;span class=&quot;tag&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;tag&quot;&gt;&amp;lt;packaging&amp;gt;&lt;/span&gt;jar&lt;span class=&quot;tag&quot;&gt;&amp;lt;/packaging&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;tag&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;0.3&lt;span class=&quot;tag&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
&lt;span class=&quot;tag&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;I&amp;#8217;m keen on feedback (say on &lt;a href=&quot;https://twitter.com/kubem&quot;&gt;@kubem at twitter&lt;/a&gt;) if you find it useful. For me, in my context, it worked and allow me to fairly safety replace the webservice connector (client) in the application I really didn&amp;#8217;t want to touch. Maybe it will work for you as well.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Some other references to this technique (also known as the Golden Master):&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;http://blog.thecodewhisperer.com/2014/09/28/surviving-legacy-code-with-golden-master-and-sampling/&quot; class=&quot;bare&quot;&gt;http://blog.thecodewhisperer.com/2014/09/28/surviving-legacy-code-with-golden-master-and-sampling/&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;http://blog.adrianbolboaca.ro/2014/05/golden-master/&quot; class=&quot;bare&quot;&gt;http://blog.adrianbolboaca.ro/2014/05/golden-master/&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
        <pubDate>Fri, 30 Jan 2015 00:00:00 +0000</pubDate>
        <link>http://jakub.marchwicki.pl/posts/2015/01/30/characterize-your-legacy-junit-rules/</link>
        <guid isPermaLink="true">http://jakub.marchwicki.pl/posts/2015/01/30/characterize-your-legacy-junit-rules/</guid>
        
        
        <category>posts</category>
        
      </item>
    
      <item>
        <title>Java EE persistence without JPA</title>
        <description>&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Regulary during JavaEE trainings I conduct a question is raised: is there persistence beyond JPA. Java Persistence API is a standard on every application server; it isn&amp;#8217;t bad - it&amp;#8217;s valid for certain use cases. Nonetheless, I regulary see a need to go beyond that. That&amp;#8217;s the reason I decided to build up &lt;a href=&quot;https://github.com/kubamarchwicki/jOOQ-javaee-example/&quot;&gt;this example&lt;/a&gt;. It shows basic configuration for jOOQ on a JavaEE 7 compliant application server (was tested with Wildfly 8.x). I will not focus on why jOOQ was chosen - it could have been any other persistence provider of you favour. This post will tackle few (three) elements of JavaEE spec which (in my opinion) were important;  handy when implementing a non JPA based &quot;database handling&quot; libraries&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;resource-producers&quot;&gt;Resource producers&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;An annotation &lt;code&gt;@javax.enterprise.inject.Produces&lt;/code&gt; is used to prepare the &lt;code&gt;DSLContext&lt;/code&gt; object (with a desired datasource and database dialect). The produced bean becomes injectable within an application as any other CDI bean (since CDI 1.0)&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;java&quot;&gt;  &lt;span class=&quot;annotation&quot;&gt;@Inject&lt;/span&gt;
  &lt;span class=&quot;directive&quot;&gt;private&lt;/span&gt; DSLContext ctx;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;This is a nice way to produce any application context related components (like loggers, debug data, additional configuration).&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;transaction-handling&quot;&gt;Transaction handling&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;JavaOOQ does not provide an API for transaction handling, but it doesn&amp;#8217;t stop it from taking any DataSource (no matter how produced). Hence, if transaction can be provided externally (outside of jOOQ) a certain level of coupling between SQL statements can be provided.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;In this example we are using &lt;code&gt;@Transactional&lt;/code&gt; annotation (since JTA 1.2).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;quoteblock&quot;&gt;
&lt;blockquote&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;The &lt;code&gt;javax.transaction.Transactional&lt;/code&gt; annotation provides the application the ability to declaratively control transaction boundaries on CDI managed beans, as well as classes defined as managed beans by the Java EE specification, at both the class and method level where method level annotations override those at the class level.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;This support is provided via an implementation of CDI interceptors that conduct the necessary suspending, resuming, etc.&lt;/p&gt;
&lt;/div&gt;
&lt;/blockquote&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;See the additional tests, which shows teh transaction is actually working. As the transaction part isn&amp;#8217;t that obvious (a border between the library and the container), I&amp;#8217;ve included this small tests with Arquillian Persistence Extension to showcase how the transaction is rolled back when a unique constraint is violated. Yes, I know the data constraints are pretty naive and simplistic - but it shows the case.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;In case of older Application Servers (JavaEE 6), a more verbose approach is required, using a lower level &lt;code&gt;UserTransaction&lt;/code&gt; API&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;java&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@Resource&lt;/span&gt;
UserTransaction tx

&lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;void&lt;/span&gt; transactionalOperation() {}
  &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; {
    tx.begin();

    &lt;span class=&quot;comment&quot;&gt;//some operations on DSLContext&lt;/span&gt;

    tx.commit();

  } &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (HeuristicRollbackException |
    RollbackException |
    NotSupportedException |
    HeuristicMixedException e) {
      tx.rollback();
      &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;exception&quot;&gt;RuntimeException&lt;/span&gt;(e);
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;application-server-datasource-configuration&quot;&gt;Application server datasource configuration&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;MySQL was used as a database for this example. Wildfly datasource configuration may look as follows:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;datasources&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;tag&quot;&gt;&amp;lt;datasource&lt;/span&gt;
    &lt;span class=&quot;attribute-name&quot;&gt;jndi-name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;java:jboss/datasources/JooqExampleDS&lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;attribute-name&quot;&gt;pool-name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;JooqExampleDS&lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;attribute-name&quot;&gt;enabled&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;attribute-name&quot;&gt;use-java-context&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;tag&quot;&gt;&amp;lt;connection-url&amp;gt;&lt;/span&gt;
      jdbc:mysql://localhost/jooq
    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/connection-url&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;tag&quot;&gt;&amp;lt;driver&amp;gt;&lt;/span&gt;mysql&lt;span class=&quot;tag&quot;&gt;&amp;lt;/driver&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;tag&quot;&gt;&amp;lt;security&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;tag&quot;&gt;&amp;lt;user-name&amp;gt;&lt;/span&gt;username&lt;span class=&quot;tag&quot;&gt;&amp;lt;/user-name&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;tag&quot;&gt;&amp;lt;password&amp;gt;&lt;/span&gt;password&lt;span class=&quot;tag&quot;&gt;&amp;lt;/password&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/security&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;tag&quot;&gt;&amp;lt;/datasource&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;tag&quot;&gt;&amp;lt;drivers&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;tag&quot;&gt;&amp;lt;driver&lt;/span&gt; &lt;span class=&quot;attribute-name&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;mysql&lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;attribute-name&quot;&gt;module&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;com.mysql&lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;gt;&lt;/span&gt; &lt;b class=&quot;conum&quot;&gt;(1)&lt;/b&gt;
      &lt;span class=&quot;tag&quot;&gt;&amp;lt;driver-class&amp;gt;&lt;/span&gt;com.mysql.jdbc.Driver&lt;span class=&quot;tag&quot;&gt;&amp;lt;/driver-class&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/driver&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;tag&quot;&gt;&amp;lt;/drivers&amp;gt;&lt;/span&gt;
&lt;span class=&quot;tag&quot;&gt;&amp;lt;/datasources&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;colist arabic&quot;&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;The module needs to be defined externally - see &lt;a href=&quot;http://wildfly.org/news/2014/02/06/GlassFish-to-WildFly-migration/&quot;&gt;Wildfly blog for reference - Creating a Module section&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;go-and-see-the-code&quot;&gt;Go and see the code!&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;So, here it goes: &lt;a href=&quot;https://github.com/kubamarchwicki/jOOQ-javaee-example/&quot; class=&quot;bare&quot;&gt;https://github.com/kubamarchwicki/jOOQ-javaee-example/&lt;/a&gt;; see if it works for you and enjoy.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
        <pubDate>Sun, 18 Jan 2015 00:00:00 +0000</pubDate>
        <link>http://jakub.marchwicki.pl/posts/2015/01/18/javaee-persistance-without-jpa/</link>
        <guid isPermaLink="true">http://jakub.marchwicki.pl/posts/2015/01/18/javaee-persistance-without-jpa/</guid>
        
        
        <category>posts</category>
        
      </item>
    
      <item>
        <title>My essential Eclipse plugins</title>
        <description>&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Upgrading IDE (Eclipse in this case) is not something you do on daily basis. What is more, I use Eclipse more and more seldomly - mostly for trainings. That&amp;#8217;s why I tend to forget which plugins I actually use (until I&amp;#8217;m missing them and need to remind myself how were they called). As this happened to my just recently (again) I decided to write this post with a list of plugins I find useful (so that I&amp;#8217;ll be able to come back during next upgrade&amp;#8230;&amp;#8203; someday)&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;baseline&quot;&gt;Baseline&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;I recently started with Spring Tool Suite as my baseline. Not that I&amp;#8217;m a Spring fan-boy. I rather consider myself from both churches: Spring and JavaEE; using both stacks as a set of tools to use in an appropriate context.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;I started with STS cause I find it nearly feature complete. It comes with Git, Maven plugins so that I don&amp;#8217;t have to wonder about basics.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;fiddling-with-the-font-size&quot;&gt;Fiddling with the font size&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;One of my most important usecases for Eclipse is during delivering a training (Eclipse is my primary IDE then). Hence, an ability to increase the font size is a must. I&amp;#8217;m quite found of using &lt;a href=&quot;https://code.google.com/p/tarlog-plugins/&quot;&gt;tarlog-plugins&lt;/a&gt; - a set of small, but useful, features to Eclipse that are develop for personal Tarlog&amp;#8217;s needs.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;While there are some other font size plugins like &lt;a href=&quot;https://code.google.com/p/eclipse-fonts/&quot;&gt;eclipse-fonts&lt;/a&gt;, tarlog-plugins just works with every file type (not just text-files)&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;migrating-workspace-settings&quot;&gt;Migrating workspace settings&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Again, due to trainings, I quite often setup a new workspace. And migrating settings from one workspace to other is a real pain in the neck. &lt;a href=&quot;https://code.google.com/a/eclipselabs.org/p/workspacemechanic/&quot;&gt;Workspace Mechanic&lt;/a&gt; is something that makes this process really easy.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;quoteblock&quot;&gt;
&lt;blockquote&gt;
The Workspace Mechanic automates maintenance of your Eclipse environment by tweaking preferences, adding extension locations, and so on.
&lt;/blockquote&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;And this really saves my day!&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;constant-test-status-preview&quot;&gt;Constant test status preview&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Trainings again. Whenever I run a refactoring or TDD session this is a life saver. Being able to constantly view the status of tests - brilliant.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;quoteblock&quot;&gt;
&lt;blockquote&gt;
Infinitest is a Continuous Testing plugin for Eclipse and IntelliJ. Each time a change is made on the source code, Infinitest runs all the tests that might fail because of these changes.
&lt;/blockquote&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;&lt;a href=&quot;http://infinitest.github.io/&quot;&gt;Grab Infinitest&lt;/a&gt; while it&amp;#8217;s hot.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;jboss-tools&quot;&gt;JBoss Tools&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;This is quite simple, I&amp;#8217;m not using it beyond managing JBoss application servers. Just to be able to showcase some code on different servers that &lt;a href=&quot;http://tomee.apache.org/&quot;&gt;TomEE&lt;/a&gt; (which I usually use - try to stay &quot;vendor agnostic&quot;).&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
        <pubDate>Mon, 01 Dec 2014 00:00:00 +0000</pubDate>
        <link>http://jakub.marchwicki.pl/posts/2014/12/01/my-essential-eclipse-plugins/</link>
        <guid isPermaLink="true">http://jakub.marchwicki.pl/posts/2014/12/01/my-essential-eclipse-plugins/</guid>
        
        
        <category>posts</category>
        
      </item>
    
      <item>
        <title>GET.NET Braindump</title>
        <description>&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;I had this enormous honour to speak (as the only Java guy) at a .NET conference. I was mainly covering clean code and good coding practices - still I found it a twist. However, it&amp;#8217;s not &lt;a href=&quot;/speaking/2014/11/22/get.net-gdansk/&quot;&gt;my &quot;Revers engineering the clean code&quot; talk&lt;/a&gt; I&amp;#8217;d like to focus on; here are some notes from Udi Dahan&amp;#8217;s keynote &quot;So you think you know pub/sub?&quot;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;so-you-think-you-know-pub-sub&quot;&gt;So you think you know pub/sub?&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Is about logical not physical data distribution&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;each event should be processed one&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;scale physical environment independently of logical architecture&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Isn&amp;#8217;t it what micro services are talking about?&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;If you&amp;#8217;ve been coding for an hour and you haven&amp;#8217;t touched a single domain problem - stop. You probably writing infrastructure&amp;#8230;&amp;#8203;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Stop every hour and review what you&amp;#8217;ve done - check if that&amp;#8217;s not infrastructure&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Make the coupling visible. It&amp;#8217;s not about hiding the coupling you already have. Seek out autonomy but preserve the single source of truth.&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;single source of truth doesn&amp;#8217;t imply shared database&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;have a single source per context&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;design logical decoupling and later on decide on physical model - putting it onto a single database.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Events are facts. Not commands - things we would like to happen&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Two type of failures. Technical and business failures&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;technical failure: developers causing business failures&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;don&amp;#8217;t deal with business failures as technical problems&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Sensors, stock market - client based filtering. Notify me of some data.&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;distributed cache&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;user machines poll the cache of the content.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;When user come along, it filters the local cache.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Pub/Sub content based filtering - will be inefficient.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
        <pubDate>Sun, 23 Nov 2014 00:00:00 +0000</pubDate>
        <link>http://jakub.marchwicki.pl/posts/2014/11/23/get.net-braindump/</link>
        <guid isPermaLink="true">http://jakub.marchwicki.pl/posts/2014/11/23/get.net-braindump/</guid>
        
        
        <category>posts</category>
        
      </item>
    
      <item>
        <title>33degree 2014 Braindump</title>
        <description>&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;think-for-yourself-marry-poppendieck&quot;&gt;Think for yourself; Marry Poppendieck&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;What great software engineers do: Sharpen the saw (develop expertise), share responsibility (deliver a real value), see the shadow of the future (make the world a better place)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Positive psychology. Started by Mihaly Csikszentmihalyi - when he started to write what&amp;#8217;s good with you people as opposed to most psychologist who wrote what&amp;#8217;s bad with you.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Elements needed to become an expert: Coach, challenge, feedback, steady progress towards getting things done&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Brilliant Systems. Mental model match: those developing the system and those actually using the system.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;App idea: the education datapalooza - as the Health Data Initiative Forum. The Health Datapalooza.
Gather, collect and open the data for everybody&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;healthcare.gov - everybody did their job, according to the spec. But all together - it didn&amp;#8217;t work.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;moving delivery organization to engineering organization:&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;delivery organization are becoming obsolete. Analyze how the time is spent in the organization (a practical approach to large scale agile development. Gary Gruver, Mike Yound and Pat Fulghum)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;accept you are wasting money on planning&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;lack of control is not a problem. Instant feedback is a better way to control the process&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&quot;imageblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;img src=&quot;/assets/33degree-braindump/mpoppendieck5.jpg&quot; alt=&quot;mpoppendieck5&quot; width=&quot;600px&quot;&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;imageblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;img src=&quot;/assets/33degree-braindump/mpoppendieck6.jpg&quot; alt=&quot;mpoppendieck6&quot; width=&quot;600px&quot;&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;imageblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;img src=&quot;/assets/33degree-braindump/mpoppendieck1.jpg&quot; alt=&quot;mpoppendieck1&quot; width=&quot;600px&quot;&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;imageblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;img src=&quot;/assets/33degree-braindump/mpoppendieck2.jpg&quot; alt=&quot;mpoppendieck2&quot; width=&quot;600px&quot;&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;imageblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;img src=&quot;/assets/33degree-braindump/mpoppendieck3.jpg&quot; alt=&quot;mpoppendieck3&quot; width=&quot;600px&quot;&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;imageblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;img src=&quot;/assets/33degree-braindump/mpoppendieck4.jpg&quot; alt=&quot;mpoppendieck4&quot; width=&quot;600px&quot;&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;managers-are-from-mars-ted-newards&quot;&gt;Managers are from Mars; Ted Newards&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Read more about Frederick Winslow Taylor. Taylor coined: you can&amp;#8217;t manage if you cannot measure.&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;It&amp;#8217;s said that this statement is flawed and was made up&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Alan Cooper. &quot;The Inmates are Running the Asylum&quot;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;nie-koduj-pisz-prozę-sławek-sobotka&quot;&gt;Nie koduj, pisz prozę; Sławek Sobotka&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;The best quotes from Slawek Sobotka:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;wszyscy wypróżniaja sie do tego samego Gita&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;encja na twarz i pchasz&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Metody szacowania&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Metoda szacowania L.W.P.z.D. &quot;Liczby Wyciągnięte Prosto z Dupy&quot;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Metoda Parkinsona&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;techniki lingwistyczne przy opisie historyjki: okazuje sie ze Wasze panie od polskiego prawie programowaly&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;w obiektowych programowaniu lubimy od tylu: reguły &amp;#8594; znaczenie (kontekst) &amp;#8594; słowa&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;sesja modelowania ze smutnymi ludźmi! nie używaj bleh albo blah to używaj greckich liter. Faktura razy dwa&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;na samym końcu dobieraj słowa - jak zrozumiesz kontekst i znaczenie na podstawie reguł&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;co sie dzieje na sesji CRC zostaje na sesji CRC&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;to była młodość. Chormony budują. Pierwszy wąs i Dune2&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;dobry obiekt jest&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;apatyczny. Nie chce mu sie robić&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;introwertyczny. Obiekty nie wchodzą z butami w inne obiekty&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;samolubny. Robi tylko swoje&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;switche pisze senior, junior pisze ify&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;hiper wymiarowa macierz statusów&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;podstawowa zasada w aplikacjach biznesowych to zmapowac (map), zredukować (reduce) i zwinąć w lewo (foldleft)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Integracja: jeden demon sie wypróżnia a drugi sprawdza czy juz&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Twoj model biznesu jest suma błędów poprzednich pokoleń.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Klucz obcy to biznes znalazł u zony w torebce. Trafiłes w czuły punkt, nie dziw się że nie chcą z Tobą gadać.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&quot;imageblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;img src=&quot;/assets/33degree-braindump/ssobotka.jpg&quot; alt=&quot;ssobotka&quot; width=&quot;600px&quot;&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;the-missing-link-of-agile-paweł-badenski&quot;&gt;The missing link of agile; Paweł Badenski&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;minimize threat (you a run away from) and maximize reward (walk towards)&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;every social interaction on the project relates to the above&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;also feedback&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Feedback. Is an observation not judgement&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;improve people&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Antipatterns&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;feedback avoidance&lt;br&gt;
Little threat in small batches (30minutes a day) is less worse than one big threat.  Avoid the lizard brain, approach feedback mindfully&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;giving advice&lt;br&gt;
Objective feedback. From non violent communication. Refer to objectives: things you see and feel. Noone can argue with that, it&amp;#8217;s very yours&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;lizard response: fight, flight or freeze&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;TED talks on neuroscience &lt;a href=&quot;http://blog.ketyov.com/2011/01/top-10-neuroscience-ted-talks.html&quot; class=&quot;bare&quot;&gt;http://blog.ketyov.com/2011/01/top-10-neuroscience-ted-talks.html&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Emotional intelligence is the basic tool for software developer&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;corrective feedback&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;watch out bully language. Judgement&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;feedback is always subjective&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;label the feelings - it&amp;#8217;s easier to handle the emotions when you know what it is&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;go-reactive-roland-kuhn&quot;&gt;Go Reactive; Roland Kuhn&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;starting point: the user&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;user is not necessarily a human.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;responsiveness: always available, interactive, (near) real time&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;not http timeout! much faster, appropriate for service&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;resilience. Responsive in the face of failure&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;one failure should not take down all other containers (comportment construction as if Titanic)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;same happens for application servers: each application server is a compartment, which cascades the other nodes.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;asynchronous calls cause synchronous calls implies coupling&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;make somebody&amp;#8217;s else exception somebody else problem. Failer response goes to the owner, all other response returns to the user&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;CAP theorem. Consistence. Availability. Partion tolerance. Theorem is proven impossible to have all three.&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;does it really needed? Who needs it?&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;take ATMs. You cannot got all three at the same time, otherwise you won&amp;#8217;t be able to take money in certain situations (offline)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;saiku-taking-olap-databases-into-21st-century-tomek-nurkiewicz&quot;&gt;Saiku – taking OLAP databases into 21st century; Tomek Nurkiewicz&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;great talk from Tomek, heard him for the first time - my bad&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;project for BigData. OpenSource OLAP cubes.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;exploring-nashorm-vankat-subramaniam&quot;&gt;Exploring Nashorm; Vankat Subramaniam&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&quot;JavaScript treats you like a guest in its house. It never complains and quietly laughs at you behind your back&quot;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;this idea: coffescript DSL run in the Server side as script with Nashorn&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;how-to-define-success-at-your-level-kai-gilb&quot;&gt;How to define Success at your level; Kai Gilb&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;focus on values. Connect stakeholder with values and derive requirements from that&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;keep iterations small. Week at most&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;http://www.gilb.com//dl820&quot;&gt;Slides&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
        <pubDate>Mon, 09 Jun 2014 00:00:00 +0000</pubDate>
        <link>http://jakub.marchwicki.pl/posts/2014/06/09/33degree-braindump/</link>
        <guid isPermaLink="true">http://jakub.marchwicki.pl/posts/2014/06/09/33degree-braindump/</guid>
        
        
        <category>posts</category>
        
      </item>
    
      <item>
        <title>(…) testing EJB application – Part VI (OpenEJB test and custom JNDI lookups)</title>
        <description>&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;This has been a while since my last post. Not that nothing happened – there has never been enough time to sit down and write those few paragraphs. I have few articles already started, but all quite far away from completion. I’ve pushing EJB testing even further (and this article will partly cover it) and focused even further on incepting such approach in the team. It looks like it’s working – the test coverage is constantly increasing from change request to change request, with new ideas being introduced. This particular one was introduced by my team mate – Greg, who was struggling with some legacy modules which were using hardcoded JNDI bindings.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;That obviously wasn’t the only thing happening recently. Additionally, there is another side project which I’ve recently started and which (I hope) will be available soon. If you are a Kindle user (or any other ebook reader – but we are targeting Kindles at first), this might be of some interest to you – preregister on &lt;a href=&quot;http://www.readpick.com&quot; class=&quot;bare&quot;&gt;http://www.readpick.com&lt;/a&gt; and stay tuned. From the technical perspective, it uses Python and Google App Engine and as the primary toolset, which made the work significantly different from a standard Java development I’ve been accustomed to. A list of helpful Python / GAE related resources in coming in a form of a blog post as well – but it needs time.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Finally, last but no least, there is this little project (in size), but great in importance thing which does not leave much time for anything else – meet Jan, my son :-) Fairly obvious why everything else become much least important – he’s the most sweet of world’s sweets.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;jndi-lookups&quot;&gt;JNDI lookups&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;But let’s get back to the problems I wanted to describe. In the solution we’ve been working with, there was a separate logging module, independent and decoupled from the core functionality. The idea was: logging was not the core functionality; in production environment the logger was putting auditing data in the database, while in test the logger might not have been deployed at all or can just log to files. Important thing was not to rely on logging, with the core solution working with correctly even if the logging is not deployed.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Nowadays, with JEE6 (EJB 3.1 in place) I’d address such requirement by injecting a typed instance of Instance&amp;lt;T&amp;gt; object. That way, I’d be able to check, later in code, if the dependency is satisfied or not. However, the environment I was using was EJB 3.0, did not have such a features and JNDI lookups was a way to go for us (also JMS was an option but messaging brought some additional resource consumption which we wanted to avoid).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;To simplify, let’s imagine such a suite of classes.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;java&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@Stateless&lt;/span&gt;
&lt;span class=&quot;annotation&quot;&gt;@LocalBinding&lt;/span&gt;(jndiBinding = &lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;mybindings/Logger&lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;)
&lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;ExternalLogger&lt;/span&gt; &lt;span class=&quot;directive&quot;&gt;implements&lt;/span&gt; ExternalLoggerLocal {

  &lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;void&lt;/span&gt; log(&lt;span class=&quot;predefined-type&quot;&gt;String&lt;/span&gt; str) {
    &lt;span class=&quot;predefined-type&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;Logging: &lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt; + str);
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;java&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@Stateless&lt;/span&gt;
&lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;LoggerFacade&lt;/span&gt; &lt;span class=&quot;directive&quot;&gt;implements&lt;/span&gt; LoggerFacadeLocal {

  ExternalLoggerLocal log = &lt;span class=&quot;predefined-constant&quot;&gt;null&lt;/span&gt;;

  &lt;span class=&quot;annotation&quot;&gt;@PostConstruct&lt;/span&gt;
  &lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;void&lt;/span&gt; postConstruct() {
    &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; {
        &lt;span class=&quot;predefined-type&quot;&gt;InitialContext&lt;/span&gt; ctx = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;predefined-type&quot;&gt;InitialContext&lt;/span&gt;();
        log = (ExternalLoggerLocal) ctx.lookup(&lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;mybindings/Logger&lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;);
    } &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;exception&quot;&gt;NamingException&lt;/span&gt; e) {
        e.printStackTrace();
    }
  }

  &lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;boolean&lt;/span&gt; log(&lt;span class=&quot;predefined-type&quot;&gt;String&lt;/span&gt; str) {
    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (log != &lt;span class=&quot;predefined-constant&quot;&gt;null&lt;/span&gt;) {
      log.log(str);
      &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;predefined-constant&quot;&gt;true&lt;/span&gt;;
    }

    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;predefined-constant&quot;&gt;false&lt;/span&gt;;
  }

}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;java&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@Stateless&lt;/span&gt;
&lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;BusinessService&lt;/span&gt; &lt;span class=&quot;directive&quot;&gt;implements&lt;/span&gt; BusinessServiceLocal {

  &lt;span class=&quot;annotation&quot;&gt;@EJB&lt;/span&gt;
  LoggerFacadeLocal logger;

  &lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;predefined-type&quot;&gt;String&lt;/span&gt; doSomeImportantStuff() {
    logger.log(&lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;Running doSomeImportantStuff()&lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;);
    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;Done&lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;;
  }

}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;The ExternalLogger might (and that’s our case) deployed as a separate module (in a different ear file). It uses vendor specific annotation (from Jboss), @LocalBinding – to hook the service under a specific name within the JNDI index. That way, the façade can lookup the logging service in a flexible way and fall back when no implementation is deployed. If @EJB annotation was used, unsatisfied dependency would have ended up in throwing an exception – which we wanted to avoid. Façade is directly used in the application.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Obviously, the implementation shown in the examples is quite naïve but I hope it describes the problem we were facing and how it was solved.
Despite the simplicity, this is a fully working application (JBoss 4.2.x deployable).&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;the-tests-problems&quot;&gt;The tests problems&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Implementation of business logic is always only one side of the story. The other are tests and a way to cover the above logic with some reasonable tests cases. We were using OpenEJB with ApplicationComposer quite extensively and it helped us a lot in writing focused integration testing. Nonetheless, it occurred to be limited and unable to test this particular case.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Testing the negative case (the logger not deployed) was fairly simple, no bean implementing ExternalLogger interface was deployed.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;java&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@RunWith&lt;/span&gt;(ApplicationComposer.class)
&lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;NoActiveLoggerTest&lt;/span&gt; {

  &lt;span class=&quot;annotation&quot;&gt;@EJB&lt;/span&gt;
  LoggerFacadeLocal facade;

  &lt;span class=&quot;annotation&quot;&gt;@Module&lt;/span&gt;
  &lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; EjbJar beans() {
    EjbJar ejbJar = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; EjbJar(&lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;loggging-app&lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;);
    ejbJar.addEnterpriseBean(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; StatelessBean(LoggerFacade.class));
    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; ejbJar;
  }

  &lt;span class=&quot;annotation&quot;&gt;@Test&lt;/span&gt;
  &lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;void&lt;/span&gt; facadeReturnsFalseOnNoActiveLogger() {
    assertFalse(facade.log(&lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;Echo&lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;));
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Testing the successful wiring of the logger was much more troublesome. It appeared there is no way to define a specific JNDI location for a component. There were ways to do it using openejb-jar.xml file but we wanted to avoid it and handle everything within the test class, as it proved to be more maintainable.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;A way for us to go was to modify the ApplicationComposer itself. Without getting much into details how the runner works (you can learn more about it from &lt;a href=&quot;/posts/2011/07/01/testing-ejb-application-openejb-without-classpath-scanning/&quot;&gt;my previous posts&lt;/a&gt; or from the &lt;a href=&quot;http://ci.apache.org/projects/openejb/examples-generated/application-composer/&quot;&gt;OpenEJB documentation&lt;/a&gt;) we were not able to output the configuration that included a specific JNDI location of a bean. Methods annotated with @Module could return EjbJar type of class, but we needed to get a level up, define a whole module with a specific JNDI. As I mentioned earlier, Greg had this idea to modify the ApplicationComposer class (which appeared to be fairly easy). The positive test case worked fine:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;java&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@RunWith&lt;/span&gt;(ApplicationComposer.class)
&lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;ActiveLoggerTest&lt;/span&gt; {

  &lt;span class=&quot;annotation&quot;&gt;@EJB&lt;/span&gt;
  LoggerFacadeLocal facade;

  &lt;span class=&quot;annotation&quot;&gt;@Module&lt;/span&gt;
  &lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; EjbModule module() {
    EjbJar ejbJar = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; EjbJar(&lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;loggging-app&lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;);
    ejbJar.addEnterpriseBean(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; StatelessBean(LoggerFacade.class));
    ejbJar.addEnterpriseBean(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; StatelessBean(ExternalLogger.class));

    EjbModule ejbModule = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; EjbModule(ejbJar, &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; OpenejbJar());
    EjbDeployment deployment =
      &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; EjbDeployment(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; StatefulBean(ExternalLogger.class));
    deployment.getJndi().add(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Jndi(&lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;mybindings/Logger&lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;Local&lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;));
    ejbModule.getOpenejbJar().addEjbDeployment(deployment);

    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; ejbModule;
  }

  &lt;span class=&quot;annotation&quot;&gt;@Test&lt;/span&gt;
  &lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;void&lt;/span&gt; facadeReturnsTrueOnActiveLoggerPresent() {
    assertTrue(facade.log(&lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;Echo&lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;));
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;The output was exactly as expected:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre&gt;INFO - Jndi(name=LoggerFacadeLocal) --&amp;gt; Ejb(deployment-id=LoggerFacade)
INFO - Jndi(name=mybindings/Logger) --&amp;gt; Ejb(deployment-id=ExternalLogger)&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;the-modifications&quot;&gt;The modifications&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;I understand that made a very specific case, which was the reason not to include it in the original runner’s code. However, as it worked for us, it might work for you as well. The patch is submitted to OpenEJB – wonder if it gets accepted (see: &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENEJB-1763&quot; class=&quot;bare&quot;&gt;https://issues.apache.org/jira/browse/OPENEJB-1763&lt;/a&gt;)&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
        <pubDate>Sat, 04 Feb 2012 00:00:00 +0000</pubDate>
        <link>http://jakub.marchwicki.pl/posts/2012/02/04/testing-ejb-application-openejb-test-and-custom-jndi-lookups/</link>
        <guid isPermaLink="true">http://jakub.marchwicki.pl/posts/2012/02/04/testing-ejb-application-openejb-test-and-custom-jndi-lookups/</guid>
        
        
        <category>posts</category>
        
      </item>
    
      <item>
        <title>Map Reduce is not about frameworks</title>
        <description>&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;When one performs a Google search for “map reduce”, the results are usually full of frameworks: Hadoop, MangoDB, Map Redcude in Amazon Elastic… and some wikipedia articles. All those frameworks support processing of massive data sets in a ditributed fashion. But map reduce is not about framework, neither about libraries that can be included in an application nor any deployable platform (infrastructure). At least not only about these. In my opinion map reduce is more about an approach, an architecture which can be implemented in a distributed environment – not necessarily using one of the mentioned frameworks. In this post I’ll describe how I used a concept of map reduce to process a massive amount sets among multiple nodes, in an asynchronous, distributed fashion.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;so-what-map-reduce-is&quot;&gt;So, what map reduce is?&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;quoteblock&quot;&gt;
&lt;blockquote&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;MapReduce is a programming model and an associated implementation for processing and generating large data sets. Users specify a map function that processes a key/value pair to generate a set of intermediate key/value pairs, and a reduce function that merges all intermediate values associated with the same intermediate key. &lt;span class=&quot;footnote&quot; id=&quot;_footnote_mapreduce&quot;&gt;[&lt;a id=&quot;_footnoteref_1&quot; class=&quot;footnote&quot; href=&quot;#_footnote_1&quot; title=&quot;View footnote.&quot;&gt;1&lt;/a&gt;]&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;attribution&quot;&gt;
&amp;#8212; MapReduce: Simplified Data Processing on Large Clusters
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;This is Google’s definition, where MapReduce was invented. If that definition isn’t clear enough, Joel Spolsky wrote a great article &quot;Can your programming language do this?&quot; &lt;span class=&quot;footnote&quot;&gt;[&lt;a id=&quot;_footnoteref_2&quot; class=&quot;footnote&quot; href=&quot;#_footnote_2&quot; title=&quot;View footnote.&quot;&gt;2&lt;/a&gt;]&lt;/span&gt; where here explains how this all works. I can’t disagree with what Joel wrote – “Without understanding functional programming, you can’t invent MapReduce &lt;span class=&quot;footnoteref&quot;&gt;[&lt;a class=&quot;footnote&quot; href=&quot;#_footnote_1&quot; title=&quot;View footnote.&quot;&gt;1&lt;/a&gt;]&lt;/span&gt;, the algorithm that makes Google so massively scalable. The terms Map and Reduce come from Lisp and functional programming.” Nonetheless, this is not only about language capabilities and it’s definitely not about frameworks. MapReduce can be also considered from an architecture and infrastructure perspective. A massive scalability can be achieved by distributing work among nodes. Without functional programming it won’t be massively flexible, but at the moment scalability was aimed.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;some-background&quot;&gt;Some background&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;The project which I’m involved in is a suite of SOAP web services, written in EJB3, deployed on a JBoss 4.2.x application server – first one to support JEE5 (to some extent). The diagram below briefly outlines the overall infrastructure.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;imageblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;img src=&quot;data:image/png;base64,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&quot; alt=&quot;Implementation view for map reduce&quot; width=&quot;720&quot; height=&quot;266&quot;&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;There are multiple independent nodes, which are proxied by loadbalancer, to provide an even traffic distribution for each of the nodes. Underneath the application layer, there is a shared database for all the nodes. The database has it’s own replication and balancing capabilities and details of that are beyond the scope of this post. The mentioned database is primarily for business data, while any realtime information (like JMS messaging, processing data) are persisted within a local, Hypersonic database – to minimize the load on the main data stores and network contingency. The architecture can be summarized as horizontally scalable through replication (simply adding more nodes).
This infrastructure evolved and was optimized overtime to address the main requirement: fastest possible, realtime processing of a single piece of information. This processing included both drilling down our own database, as well as decorating response data with some additional information, provided by a suite of external services (with additional webservice calls). With time our system evolved into a single ‘point-of-contact’ facade for quite a significant number of external services. That brings us to the latest requirement and indirectly to MapReduce.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;substituting-batch-processing-with-webservices&quot;&gt;Substituting batch processing with webservices&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;One of the many external service which we’ve been utilizing in our solution, was also manually processed in a batch fashion; an email with CSV data was sent and the receiving party processed the data. Our solution has been doing pretty much the same, but for a single data item. Extending the system capabilities to process multiple rows, to substitute the quasi manual process seemed to be a natural evolution and that was the main objective for the project. The ‘multiple’ factor was quite scarry – up to few million records in a single process. The decision was to utilize all of the nodes, but in a more parallel fashion. What was needed was a way for robust asynchronous processing of the data and collecting the results, utilize the nodes (which are quite powerful boxes) in a maximum way and keep the load on any other machine as low as possible. That brings us to Map Reduce.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;map-reduce-is-everywhere&quot;&gt;Map Reduce is everywhere&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;So, for Map Reduce we need two things: a mapper and a reducer. In case of the described solution, the map is a simple perl script, which splits an incoming flat file into multiple chunks (not to kill a single node with all requests). The script assigns an unique process id, which as attached to the processing data. Each chunk is independently sent, through load-balancer, to any of the nodes. That triggers asynchronous processing.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;The ‘service gateway’ is a REST webservice – to keep it simple, straightforward and to minimize the network traffic (an alternative was SOAP). I still plan to describe deployment of RESTful web services with JBoss 4.x (which is an infrastructure I’m working with) at some point in the future. So far – it’s out of scope.
So that is the mapper. What’s still needed is a reducer. All the services use a shared database underneath. All business critical information as stored there. It’s a clustered RDMS and is performing pretty well. That way, database become the reducer. After asynchronous processing the data (calling an external service, processing and analysing the response), the data is persisted into the database. It is easy to retrieve the data with the unique, upfront generated id.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;some-conclusions&quot;&gt;Some conclusions&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;The environment which is used is definitely not the latest, most cutting edge technology stack. Well, JBoss 4.2.x with Java 5 is far better than Java 1.3, but it is still not something most developers are keen on working with. Though the technology stack is not our choice and there is no way to change it or upgrade (you probably know the ‘corporate ideas’ of technology freeze – that’s the case), it’s not always a dead end. There are always things to push forward and boxes to think outside of. Many new, cutting edge ideas can be implemented at the top of ‘not-so-modern’ technology stack. It always require a little more wiring, some boilerplate code than an out-of-the-box framework, but it’s almost always worth it. After all, the fun factor is always important even in a daily job.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;div class=&quot;footnote&quot; id=&quot;_footnote_1&quot;&gt;
&lt;a href=&quot;#_footnoteref_1&quot;&gt;1&lt;/a&gt; &lt;a href=&quot;http://labs.google.com/papers/mapreduce.html&quot; class=&quot;bare&quot;&gt;http://labs.google.com/papers/mapreduce.html&lt;/a&gt;
&lt;/div&gt;
&lt;div class=&quot;footnote&quot; id=&quot;_footnote_2&quot;&gt;
&lt;a href=&quot;#_footnoteref_2&quot;&gt;2&lt;/a&gt; &lt;a href=&quot;http://www.joelonsoftware.com/items/2006/08/01.html&quot; class=&quot;bare&quot;&gt;http://www.joelonsoftware.com/items/2006/08/01.html&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
        <pubDate>Tue, 20 Sep 2011 00:00:00 +0000</pubDate>
        <link>http://jakub.marchwicki.pl/posts/2011/09/20/map-reduce-is-not-about-frameworks/</link>
        <guid isPermaLink="true">http://jakub.marchwicki.pl/posts/2011/09/20/map-reduce-is-not-about-frameworks/</guid>
        
        
        <category>posts</category>
        
      </item>
    
      <item>
        <title>(…) testing EJB application – Part V (OpenEJB without classpath scanning)</title>
        <description>&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;I’ve recently come across &lt;a href=&quot;http://blog.thecodewhisperer.com/2010/10/16/integrated-tests-are-a-scam/&quot;&gt;a very good article on integrated testing&lt;/a&gt; (with a provocative title: Integrated Test Are a Scam). The writing basically question most of my efforts and the sense of this series (as a whole) – integrated tests are bad and you should rather avoid doing it. Unit tests rocks. I cannot agree more. However, as J.B. points out there are moments when an integrated test brings some value (whew, the series saved). An this is where tools like OpenEJB proves its value. On the other hand, the way OpenEJB works pushes the user to end-to-end integration testing – SCAM!&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;the-biggest-openejb-disadvantage&quot;&gt;The biggest OpenEJB disadvantage&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Yeah, the necessity of the end-to-end testing is the biggest drawback of OpenEJB. It’s not easy to bootstrap a part of the containter (which I think I’ve shown &lt;a href=&quot;/posts/2011/06/29/testing-ejb-application-openejb-with-vendor-extensions-and-ejb-jar-xml/&quot;&gt;in the previous write-up&lt;/a&gt;). I found it close to impossible to be selective about which service gets deployed, which effectively means you cannot test half-baked code. If the whole application does not wire together (because the development is still in progress – for example), container does not boot, test fails (even though what’s tested is a completely independent area). This effectively makes the tools useless, when your development is test driven.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;See the example of the persistence.xml, from &lt;a href=&quot;/posts/2011/06/09/the-art-of-testing-an-ejb-application-openejb/&quot;&gt;the first OpenEJB part&lt;/a&gt; – even though the database was not used in the test, a decent effort was required just to make it working. That’s what I’m tacking about and that’s the essence of the J.B.’s “Integrated Tests Are A Scam” article – hell a lot of effort is wasted in getting the stuff working, maintaining, before the actual tests are even written. This is not – in any case – critique of OpenEJB. As I wrote earlier, it’s a great tool but it looks like the way I was trying to use it was not exactly the fit for purpose. Now I know, an embeddable container for tests was the primary objective of creators, probably not. That’s why I started to think about something more tests oriented. One idea was &lt;a href=&quot;http://www.jboss.org/arquillian&quot;&gt;Arquillian&lt;/a&gt;; the other was to push OpenEJB harder, post questions to OpenEJB Users group, contact developers (as I’ve mentioned at the end of the last post – &lt;a href=&quot;http://openejb.979440.n4.nabble.com/override-annotation-based-configuration-with-ejb-jar-xml-td3628804.html&quot;&gt;see the discussion @ nabble.com&lt;/a&gt;). The later option appeared to be more agile’ish and with help from David Blevins, I found ways to test EJB without deploying the whole container. After all, it was easier to re-use that knowledge than get hands dirty with yet another technology and framework.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;focused-integration-testing&quot;&gt;Focused integration testing&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;I think this is a bit I’ve been missing so far. A few helper classes have been introduced in OpenEJB 3.1.4 so first of all pom upgrade is required. Additionally, this is a fairly new functionality and core library only supports JUnit. As you could’ve seen in the examples – I’ve opted for the TestNG framework which works slightly different. An integration for TestNG is already in place, but unfortunately not yet committed (see &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENEJB-1526&quot;&gt;the JIRA ticket for that&lt;/a&gt;). Anyway, after adding AbstractOpenEJBTestNG class to the application, the test class looks like that&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;java&quot;&gt;&lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;MethodControllerTest&lt;/span&gt; &lt;span class=&quot;directive&quot;&gt;extends&lt;/span&gt; AbstractOpenEJBTestNG {

  &lt;span class=&quot;annotation&quot;&gt;@EJB&lt;/span&gt;
  MethodControllerLocal controller;

  &lt;span class=&quot;annotation&quot;&gt;@Module&lt;/span&gt;
  &lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; EjbJar beans() {
    EjbJar ejbJar = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; EjbJar(&lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;calculation-beans&lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;);
    ejbJar.addEnterpriseBean(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; StatelessBean(TestingDisplayingService.class));
    ejbJar.addEnterpriseBean(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; StatelessBean(CalculatingService.class));
    ejbJar.addEnterpriseBean(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; StatelessBean(MethodController.class));
    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; ejbJar;
  }

  &lt;span class=&quot;comment&quot;&gt;//... some test methods&lt;/span&gt;
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Lovely, isn’t it? AbstractOpenEJBTestNG is not fully compliant with 3.1.4 version so some fine-tuning is necessary. If you need it badly for your tests (and I assume so – if you are reading this) – take the one from my probject on github: &lt;a href=&quot;https://github.com/kubamarchwicki/ejb-testing/blob/app-composer/ejb/src/test/java/org/apache/openejb/testng/AbstractOpenEJBTestNG.java&quot;&gt;AbstractOpenEJBTestNG&lt;/a&gt;. Everything works like a charm- happy days.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;finally&quot;&gt;Finally&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;To be honest, this is something I’ve been looking for. This is where OpenEJB and Arquillian worlds meet each other. As David Blevins pointed out: “(This is) how we write our internal tests and is a big influence on Arquillian — OpenEJB was a pretty critical part of Arquillian when they were first getting it going”.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Additionally, besides all the advantages outlined above (robustness, easiness etc), all my integration tests run much faster. Maybe it’s not clearly visible in the example application, where tests are small, but in real life app (like the one I’m working with currently) it’s a significant improvement. ‘The big project’ I’m working on, where I also implemented the described approach, builds now significantly faster. There is no need to scan classpath, handle persistence context for each and every test. I think we are now talking about truly focused integration testing.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;PS. If you are looking for core JUnit examples, Application Composer example from OpenEJB is pretty nifty: &lt;a href=&quot;http://people.apache.org/~dblevins/application-composer/&quot; class=&quot;bare&quot;&gt;http://people.apache.org/~dblevins/application-composer/&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;PS2. The complete source code is available on my github account: &lt;a href=&quot;https://github.com/kubamarchwicki/ejb-testing/tree/app-composer&quot; class=&quot;bare&quot;&gt;https://github.com/kubamarchwicki/ejb-testing/tree/app-composer&lt;/a&gt;. All the EJB examples have been refactored to utilise the ‘application composer’ approach. I hope you find it helpful&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
        <pubDate>Fri, 01 Jul 2011 00:00:00 +0000</pubDate>
        <link>http://jakub.marchwicki.pl/posts/2011/07/01/testing-ejb-application-openejb-without-classpath-scanning/</link>
        <guid isPermaLink="true">http://jakub.marchwicki.pl/posts/2011/07/01/testing-ejb-application-openejb-without-classpath-scanning/</guid>
        
        
        <category>posts</category>
        
      </item>
    
      <item>
        <title>(…) testing an EJB application – Part IV (OpenEJB with vendor extensions and ejb-jar.xml)</title>
        <description>&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;&lt;a href=&quot;/posts/2011/06/09/the-art-of-testing-an-ejb-application-openejb/&quot;&gt;The previous post of EJB testing featured OpenEJB bootstrapping and handling different configurations&lt;/a&gt; (or better say overwriting the defaults). This time I want to focus on vendor extensions, which are not supported by OpenEJB and ways to include them in the testing context. This way I’ll tackle ejb-jar.xml files, which can provide alternate dependencies for beans in context. I’ll iterate over a sample application which is available on &lt;a href=&quot;https://github.com/kubamarchwicki/ejb-testing&quot;&gt;github&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;the-wider-context&quot;&gt;The wider context&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;I’ve already mentioned I’m using JBoss and the vendor extension which I’m referring to is a @Service annotation. JBoss does not support a @Singleton EJB annotation and @Service is supposed to be an alternative (this refers to versions 4.x and 5.x – I haven’t tested it, but I suppose @Singleton annotation works fine in JBoss6). I’ve been using JBoss @Services for two reasons: managed configuration beans and basic cache. The big advantage of a managed-bean service is that there will be only one instance of the service bean (no pooling) so the instance is effectively a singleton. That way the bean’s shared state is accessible by other clients. This is important to remember because it’s not always a desired behaviour.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;To put this in context of the sample-example application, lets assume an interface to our calculator application is a custom, concatenated string, which needs to be parsed (if you need a reason, let’s say we are running service manually from the jmx-console). The parser we are using works very quickly, but the initialization takes long enough to be worried about the run-time performance (quite a common non-functional requirement when a Dozer Mapper or Hibernate Validator is used – initialization takes some time). Using a service to initialize it on startup does not seem such a bad idea. Additionally, there is a requirement to change some of the configuration properties in run-time. In our particular case, the configuration is used for a flexible customizing the display. A configuration managed bean will be used to fulfil this ‘requirement’.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;services&quot;&gt;Services&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;First of all, before we even get to building a service, appropriate dependencies need including. @Service is a vendor extension so a jboss jar needs referencing:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;tag&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;jboss&lt;span class=&quot;tag&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;tag&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;jboss-annotations-ejb3&lt;span class=&quot;tag&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;span class=&quot;tag&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;That way access to @Service and @Management annotations is available. Building a singleton bean is as easy as adding those two annotations to a desired class:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;java&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@Service&lt;/span&gt;(objectName=&lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;pl.marchwicki.view.settings:service=displaySettings&lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;)
&lt;span class=&quot;annotation&quot;&gt;@Management&lt;/span&gt;(DisplaySettingsMBean.class)
&lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;DisplaySettings&lt;/span&gt; &lt;span class=&quot;directive&quot;&gt;implements&lt;/span&gt; DisplaySettingsMBean {
  &lt;span class=&quot;comment&quot;&gt;//... business methods&lt;/span&gt;
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Another important note: while in case of setting mbean we don’t need to any additional lifecycle methods in the interface (like start, stop, create, destroy), in case of caching bean, a start() method is very helpful. At some point of the lifecycle the mapper needs initialization. In normal EJB environment it would be @PostConstruct, but as we are using vendor specific extensions it all works slightly different. What would have normally been put to @PostConstruct, gets executed in start() method.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;successful-deployment&quot;&gt;Successful deployment&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;When the application is built and deployed we see following information in the log file (acknowledging successful deployment):&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre&gt;INFO  [EJBContainer] STARTED EJB: pl.marchwicki.ejb.frontend.StringToArrayMappingService
    ejbName: StringToArrayMappingService
INFO  [Mapper] Mapper initialized
INFO  [StringToArrayMappingService] Mapper set
INFO  [EJBContainer] STARTED EJB: pl.marchwicki.ejb.view.configuration.DisplaySettings
    ejbName: DisplaySettings&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Now, it’s possible to invoke the add() method from calculationFacade service, from the jmx-console. With argument “1;2;3;4” we see appropriate result in logs:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre&gt;INFO  [STDOUT] : Result of ADD operation is: 10&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;It’s also possible to change the display template (in the displaySettings bean), so the result looks slightly different:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre&gt;INFO  [STDOUT] @@@@@ Result of ADD operation is: 10&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Everything works fine… however, describing the nature of JBoss ‘singletons’ was not the objective for this post. It was supposed to be about testing.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;initializing-vendor-specific-beans-in-tests&quot;&gt;Initializing vendor specific beans in tests&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;I must admit there was a little trick – I’ve been running maven with the skip-tests flag set. I wanted to show the application is running on the application server, to emphasize the differences and issues with OpenEJB for testing. When the tests are run, the build fails (even though everything works smooth on the server):&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre&gt;WARN - Unresolved ejb reference
   &quot;pl.marchwicki.ejb.view.DisplayingService/settings&quot; in bean
   &quot;DisplayingService&quot;.  Will attempt resolution again at runtime.
WARN - Injection data not found in enc:
   jndiName=&#39;pl.marchwicki.ejb.view.DisplayingService/settings&#39;,
   target=class pl.marchwicki.ejb.view.DisplayingService/settings&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;OpenEJB is unable to resolve the managed beans. No surprise – these are JBoss services afterall. Now it’s time for manual setup, with an ejb-jar.xml. First of all – we need to handle DisplaySettings by defining the bean as follows:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;xml&quot;&gt;&lt;span class=&quot;preprocessor&quot;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;&lt;/span&gt;
&lt;span class=&quot;tag&quot;&gt;&amp;lt;ejb-jar&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;tag&quot;&gt;&amp;lt;enterprise-beans&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;tag&quot;&gt;&amp;lt;session&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;tag&quot;&gt;&amp;lt;ejb-name&amp;gt;&lt;/span&gt;DisplaySettings&lt;span class=&quot;tag&quot;&gt;&amp;lt;/ejb-name&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;tag&quot;&gt;&amp;lt;business-local&amp;gt;&lt;/span&gt;pl.marchwicki.ejb.view.configuration.DisplaySettingsMBean&lt;span class=&quot;tag&quot;&gt;&amp;lt;/business-local&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;tag&quot;&gt;&amp;lt;ejb-class&amp;gt;&lt;/span&gt;pl.marchwicki.ejb.view.configuration.DisplaySettings&lt;span class=&quot;tag&quot;&gt;&amp;lt;/ejb-class&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;tag&quot;&gt;&amp;lt;session-type&amp;gt;&lt;/span&gt;Stateless&lt;span class=&quot;tag&quot;&gt;&amp;lt;/session-type&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;tag&quot;&gt;&amp;lt;env-entry&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;tag&quot;&gt;&amp;lt;description&amp;gt;&lt;/span&gt;Display template&lt;span class=&quot;tag&quot;&gt;&amp;lt;/description&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;tag&quot;&gt;&amp;lt;env-entry-name&amp;gt;&lt;/span&gt;setDisplayTemplate&lt;span class=&quot;tag&quot;&gt;&amp;lt;/env-entry-name&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;tag&quot;&gt;&amp;lt;env-entry-type&amp;gt;&lt;/span&gt;java.lang.String&lt;span class=&quot;tag&quot;&gt;&amp;lt;/env-entry-type&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;tag&quot;&gt;&amp;lt;env-entry-value&amp;gt;&lt;/span&gt;------- {} -------&lt;span class=&quot;tag&quot;&gt;&amp;lt;/env-entry-value&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;tag&quot;&gt;&amp;lt;injection-target&amp;gt;&lt;/span&gt;
                  &lt;span class=&quot;tag&quot;&gt;&amp;lt;injection-target-class&amp;gt;&lt;/span&gt;pl.marchwicki.ejb.view.configuration.DisplaySettings&lt;span class=&quot;tag&quot;&gt;&amp;lt;/injection-target-class&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;tag&quot;&gt;&amp;lt;injection-target-name&amp;gt;&lt;/span&gt;setDisplayTemplate&lt;span class=&quot;tag&quot;&gt;&amp;lt;/injection-target-name&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;tag&quot;&gt;&amp;lt;/injection-target&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;tag&quot;&gt;&amp;lt;/env-entry&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/session&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;tag&quot;&gt;&amp;lt;/enterprise-beans&amp;gt;&lt;/span&gt;
&lt;span class=&quot;tag&quot;&gt;&amp;lt;/ejb-jar&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;After that, the application builds successfully, tests run smoothly and an expected message shows up in the console (formatted as defined).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre&gt;------- Result of ADD operation is: 10 -------&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;The caching service can be handled in a very similar way. Starting with a test, which obviously fails:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;CodeRay highlight&quot;&gt;&lt;code data-lang=&quot;java&quot;&gt;&lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;CalculationFacadeTest&lt;/span&gt; {

  CalculationFacadeLocal facade;

  &lt;span class=&quot;annotation&quot;&gt;@BeforeClass&lt;/span&gt;
  &lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;void&lt;/span&gt; setup() &lt;span class=&quot;directive&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;exception&quot;&gt;NamingException&lt;/span&gt; {
    &lt;span class=&quot;predefined-type&quot;&gt;InitialContext&lt;/span&gt; ctx = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;predefined-type&quot;&gt;InitialContext&lt;/span&gt;();
    facade = (CalculationFacadeLocal) ctx.lookup(&lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;CalculationFacadeLocal&lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;);
  }

  &lt;span class=&quot;annotation&quot;&gt;@Test&lt;/span&gt;
  &lt;span class=&quot;directive&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;void&lt;/span&gt; simpleAdding() {
    &lt;span class=&quot;predefined-type&quot;&gt;String&lt;/span&gt; args = &lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;1;2;3;4&lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;;
    &lt;span class=&quot;predefined-type&quot;&gt;String&lt;/span&gt; calculate = facade.add(args);
    Assert.assertEquals(&lt;span class=&quot;string&quot;&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;content&quot;&gt;200 OK&lt;/span&gt;&lt;span class=&quot;delimiter&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;, calculate);
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre&gt;FAILED CONFIGURATION: @BeforeClass setup
    javax.naming.NameNotFoundException: Name &quot;CalculationFacadeLocal&quot; not found.&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;OpenEJB does not handle out service annotation so a similar approach with ejb-jar.xml is required. Definition is fairly simple, so after adding both services to context… the test fails again – but more gracefully.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre&gt;Caused by: java.lang.NullPointerException
    at pl.marchwicki.ejb.frontend.StringToArrayMappingService.map(StringToArrayMappingService.java:18)&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;The cached mapper needs manual initializing – not surprise. We can add this extra step into @BeforeClass method of the test (lookup the bean in the context and manually run the start() method) and voila! Build successful. Surprising is that OpenEJB does not call create() method on startup – even though it says so in the logs.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;beyond-initialization&quot;&gt;Beyond initialization&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Simple initialization is not the only useful thing about ejb-jar.xml. Let’s say we aim to mock some services – take DisplayingService. As the ‘sophisticated templates’ are not required for tests, so let’s replace them with a simplest possible implementation – displaying results to console without any formatting. As you could have noticed, OpenEJB does not give you much flexibility in what to use. Classpath is scanned, beans are created. What is more, OpenEJB does not care much if more than one implementation of the business interface is present in context. The first one is picked and wired (which I can accept to some extent). It gets worse when the application consists of multiple ears which all get wrapped into single ear on tests. After that it’s impossible to tell which implementation is used.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;So let’s create additional implementation of DisplayingServiceLocal. Unfortunately, even though additional bean is discovered, it’s successfully deployed – still the default implementation is used. There is no way to tell, which implementation is going to be picked up by the container (and there is not way to tell the container to pick a desired implementation).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;One solution is to directly reference an instance with beanName attribute within the @EJB annotation. Works like a charm, however I don’t think it’s a good practice to change the application logic to have tests running smoothly.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Another, in my opinion an intuitive approach would be to use ‘after-everything-is-setup’ configuration file, override dependencies and manually wire appropriate beans. Unfortunately, that’s not possible (at least I haven’t found a way to do it). Even if alternate deployment descriptors are defined (as described in &lt;a href=&quot;http://openejb.apache.org/3.0/alternate-descriptors.html&quot;&gt;alternate descriptors manual page of OpenEJB&lt;/a&gt;), only the first one is loaded (other are ignored). Manual wiring (of MethodController – for example) in ejb-jar.xml results with NullPointerException (cause classpath discovery is performed latter). On the other hand, a full initialization of bean in ejb-jar.xml results with a nasty javax.naming.NameAlreadyBoundException (when the classpath is scanned).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;I gave up. Posted question to a mailing list – see what happens. Made myself some more room to try something else – Arquillian.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;some-conclusions&quot;&gt;Some conclusions&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Probably after reading all these you think OpenEJB is an overkill, a fairly complicated and not easy to use tool. I can bet you are close to give up testing (at least integration) because ‘there is now way to do it efficiently and I’ll just click the app through’. Well, you are not the first one. I’ve been there as well, nearly giving up. After a while (and a decent drilling down) I’d withdraw my initial pessimism. I agree OpenEJB is not the best tool for testing – but that’s better than nothing (fanboys note: I’ll be covering Arquillian later on – I’ve just written few seconds earlier). It works fine with end-to-end integration testing. On the other hand, the focused integration tests are fairly challenging (as you could’ve seen in this post). It all works fine a long as you are not trying to beat the game.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Final thoughts; the steps and tools I’ve described in this and previous posts saved me hours of booting and restarting application server. After a while I started to implement whole change requests without touching the application server. Nevertheless, I think it’s time to move on – in the next episode I plan to fork the existing code reimplement all the tests with Arquillian. Stay tuned!&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
        <pubDate>Wed, 29 Jun 2011 00:00:00 +0000</pubDate>
        <link>http://jakub.marchwicki.pl/posts/2011/06/29/testing-ejb-application-openejb-with-vendor-extensions-and-ejb-jar-xml/</link>
        <guid isPermaLink="true">http://jakub.marchwicki.pl/posts/2011/06/29/testing-ejb-application-openejb-with-vendor-extensions-and-ejb-jar-xml/</guid>
        
        
        <category>posts</category>
        
      </item>
    
  </channel>
</rss>
