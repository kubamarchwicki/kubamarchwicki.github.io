<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Notepack</title>
    <description>A randomized pack of notes</description>
    <link>http://jakub.marchwicki.pl/</link>
    <atom:link href="http://jakub.marchwicki.pl/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>Tue, 11 Nov 2014 22:16:46 +0000</pubDate>
    <lastBuildDate>Tue, 11 Nov 2014 22:16:46 +0000</lastBuildDate>
    <generator>Jekyll v2.4.0</generator>
    
      <item>
        <title>33degree 2014 Braindump</title>
        <description>&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;think-for-yourself-marry-poppendieck&quot;&gt;Think for yourself; Marry Poppendieck&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;What great software engineers do: Sharpen the saw (develop expertise), share responsibility (deliver a real value), see the shadow of the future (make the world a better place)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Positive psychology. Started by Mihaly Csikszentmihalyi - when he started to write what&amp;#8217;s good with you people as opposed to most psychologist who wrote what&amp;#8217;s bad with you.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Elements needed to become an expert: Coach, challenge, feedback, steady progress towards getting things done&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Brilliant Systems. Mental model match: those developing the system and those actually using the system.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;App idea: the education datapalooza - as the Health Data Initiative Forum. The Health Datapalooza.
Gather, collect and open the data for everybody&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;healthcare.gov - everybody did their job, according to the spec. But all together - it didn&amp;#8217;t work.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;moving delivery organization to engineering organization:&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;delivery organization are becoming obsolete. Analyze how the time is spent in the organization (a practical approach to large scale agile development. Gary Gruver, Mike Yound and Pat Fulghum)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;accept you are wasting money on planning&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;lack of control is not a problem. Instant feedback is a better way to control the process&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&quot;imageblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;img src=&quot;/assets/33degree-braindump/mpoppendieck5.jpg&quot; alt=&quot;mpoppendieck5&quot; width=&quot;600px&quot;&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;imageblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;img src=&quot;/assets/33degree-braindump/mpoppendieck6.jpg&quot; alt=&quot;mpoppendieck6&quot; width=&quot;600px&quot;&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;imageblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;img src=&quot;/assets/33degree-braindump/mpoppendieck1.jpg&quot; alt=&quot;mpoppendieck1&quot; width=&quot;600px&quot;&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;imageblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;img src=&quot;/assets/33degree-braindump/mpoppendieck2.jpg&quot; alt=&quot;mpoppendieck2&quot; width=&quot;600px&quot;&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;imageblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;img src=&quot;/assets/33degree-braindump/mpoppendieck3.jpg&quot; alt=&quot;mpoppendieck3&quot; width=&quot;600px&quot;&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;imageblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;img src=&quot;/assets/33degree-braindump/mpoppendieck4.jpg&quot; alt=&quot;mpoppendieck4&quot; width=&quot;600px&quot;&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;managers-are-from-mars-ted-newards&quot;&gt;Managers are from Mars; Ted Newards&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Read more about Frederick Winslow Taylor. Taylor coined: you can&amp;#8217;t manage if you cannot measure.&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;It&amp;#8217;s said that this statement is flawed and was made up&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Alan Cooper. &quot;The Inmates are Running the Asylum&quot;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;nie-koduj-pisz-prozę-sławek-sobotka&quot;&gt;Nie koduj, pisz prozę; Sławek Sobotka&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;The best quotes from Slawek Sobotka:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;wszyscy wypróżniaja sie do tego samego Gita&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;encja na twarz i pchasz&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Metody szacowania&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Metoda szacowania L.W.P.z.D. &quot;Liczby Wyciągnięte Prosto z Dupy&quot;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Metoda Parkinsona&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;techniki lingwistyczne przy opisie historyjki: okazuje sie ze Wasze panie od polskiego prawie programowaly&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;w obiektowych programowaniu lubimy od tylu: reguły &amp;#8594; znaczenie (kontekst) &amp;#8594; słowa&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;sesja modelowania ze smutnymi ludźmi! nie używaj bleh albo blah to używaj greckich liter. Faktura razy dwa&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;na samym końcu dobieraj słowa - jak zrozumiesz kontekst i znaczenie na podstawie reguł&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;co sie dzieje na sesji CRC zostaje na sesji CRC&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;to była młodość. Chormony budują. Pierwszy wąs i Dune2&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;dobry obiekt jest&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;apatyczny. Nie chce mu sie robić&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;introwertyczny. Obiekty nie wchodzą z butami w inne obiekty&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;samolubny. Robi tylko swoje&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;switche pisze senior, junior pisze ify&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;hiper wymiarowa macierz statusów&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;podstawowa zasada w aplikacjach biznesowych to zmapowac (map), zredukować (reduce) i zwinąć w lewo (foldleft)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Integracja: jeden demon sie wypróżnia a drugi sprawdza czy juz&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Twoj model biznesu jest suma błędów poprzednich pokoleń.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Klucz obcy to biznes znalazł u zony w torebce. Trafiłes w czuły punkt, nie dziw się że nie chcą z Tobą gadać.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&quot;imageblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;img src=&quot;/assets/33degree-braindump/ssobotka.jpg&quot; alt=&quot;ssobotka&quot; width=&quot;600px&quot;&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;the-missing-link-of-agile-paweł-badenski&quot;&gt;The missing link of agile; Paweł Badenski&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;minimize threat (you a run away from) and maximize reward (walk towards)&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;every social interaction on the project relates to the above&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;also feedback&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Feedback. Is an observation not judgement&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;improve people&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Antipatterns&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;feedback avoidance&lt;br&gt;
Little threat in small batches (30minutes a day) is less worse than one big threat.  Avoid the lizard brain, approach feedback mindfully&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;giving advice&lt;br&gt;
Objective feedback. From non violent communication. Refer to objectives: things you see and feel. Noone can argue with that, it&amp;#8217;s very yours&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;lizard response: fight, flight or freeze&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;TED talks on neuroscience &lt;a href=&quot;http://blog.ketyov.com/2011/01/top-10-neuroscience-ted-talks.html&quot; class=&quot;bare&quot;&gt;http://blog.ketyov.com/2011/01/top-10-neuroscience-ted-talks.html&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Emotional intelligence is the basic tool for software developer&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;corrective feedback&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;watch out bully language. Judgement&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;feedback is always subjective&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;label the feelings - it&amp;#8217;s easier to handle the emotions when you know what it is&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;go-reactive-roland-kuhn&quot;&gt;Go Reactive; Roland Kuhn&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;starting point: the user&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;user is not necessarily a human.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;responsiveness: always available, interactive, (near) real time&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;not http timeout! much faster, appropriate for service&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;resilience. Responsive in the face of failure&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;one failure should not take down all other containers (comportment construction as if Titanic)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;same happens for application servers: each application server is a compartment, which cascades the other nodes.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;asynchronous calls cause synchronous calls implies coupling&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;make somebody&amp;#8217;s else exception somebody else problem. Failer response goes to the owner, all other response returns to the user&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;CAP theorem. Consistence. Availability. Partion tolerance. Theorem is proven impossible to have all three.&lt;/p&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;does it really needed? Who needs it?&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;take ATMs. You cannot got all three at the same time, otherwise you won&amp;#8217;t be able to take money in certain situations (offline)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;saiku-taking-olap-databases-into-21st-century-tomek-nurkiewicz&quot;&gt;Saiku – taking OLAP databases into 21st century; Tomek Nurkiewicz&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;great talk from Tomek, heard him for the first time - my bad&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;project for BigData. OpenSource OLAP cubes.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;exploring-nashorm-vankat-subramaniam&quot;&gt;Exploring Nashorm; Vankat Subramaniam&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&quot;JavaScript treats you like a guest in its house. It never complains and quietly laughs at you behind your back&quot;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;this idea: coffescript DSL run in the Server side as script with Nashorn&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;how-to-define-success-at-your-level-kai-gilb&quot;&gt;How to define Success at your level; Kai Gilb&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;focus on values. Connect stakeholder with values and derive requirements from that&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;keep iterations small. Week at most&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;http://www.gilb.com//dl820&quot;&gt;Slides&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
        <pubDate>Mon, 09 Jun 2014 00:00:00 +0000</pubDate>
        <link>http://jakub.marchwicki.pl/posts/2014/06/09/33degree-braindump/</link>
        <guid isPermaLink="true">http://jakub.marchwicki.pl/posts/2014/06/09/33degree-braindump/</guid>
        
        
        <category>posts</category>
        
      </item>
    
      <item>
        <title>(…) testing EJB application – Part VI (OpenEJB test and custom JNDI lookups)</title>
        <description>&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;This has been a while since my last post. Not that nothing happened – there has never been enough time to sit down and write those few paragraphs. I have few articles already started, but all quite far away from completion. I’ve pushing EJB testing even further (and this article will partly cover it) and focused even further on incepting such approach in the team. It looks like it’s working – the test coverage is constantly increasing from change request to change request, with new ideas being introduced. This particular one was introduced by my team mate – Greg, who was struggling with some legacy modules which were using hardcoded JNDI bindings.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;That obviously wasn’t the only thing happening recently. Additionally, there is another side project which I’ve recently started and which (I hope) will be available soon. If you are a Kindle user (or any other ebook reader – but we are targeting Kindles at first), this might be of some interest to you – preregister on &lt;a href=&quot;http://www.readpick.com&quot; class=&quot;bare&quot;&gt;http://www.readpick.com&lt;/a&gt; and stay tuned. From the technical perspective, it uses Python and Google App Engine and as the primary toolset, which made the work significantly different from a standard Java development I’ve been accustomed to. A list of helpful Python / GAE related resources in coming in a form of a blog post as well – but it needs time.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Finally, last but no least, there is this little project (in size), but great in importance thing which does not leave much time for anything else – meet Jan, my son :-) Fairly obvious why everything else become much least important – he’s the most sweet of world’s sweets.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;jndi-lookups&quot;&gt;JNDI lookups&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;But let’s get back to the problems I wanted to describe. In the solution we’ve been working with, there was a separate logging module, independent and decoupled from the core functionality. The idea was: logging was not the core functionality; in production environment the logger was putting auditing data in the database, while in test the logger might not have been deployed at all or can just log to files. Important thing was not to rely on logging, with the core solution working with correctly even if the logging is not deployed.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Nowadays, with JEE6 (EJB 3.1 in place) I’d address such requirement by injecting a typed instance of Instance&amp;lt;T&amp;gt; object. That way, I’d be able to check, later in code, if the dependency is satisfied or not. However, the environment I was using was EJB 3.0, did not have such a features and JNDI lookups was a way to go for us (also JMS was an option but messaging brought some additional resource consumption which we wanted to avoid).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;To simplify, let’s imagine such a suite of classes.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;@Stateless
@LocalBinding(jndiBinding = &quot;mybindings/Logger&quot;)
public class ExternalLogger implements ExternalLoggerLocal {

  public void log(String str) {
    System.out.println(&quot;Logging: &quot; + str);
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;@Stateless
public class LoggerFacade implements LoggerFacadeLocal {

  ExternalLoggerLocal log = null;

  @PostConstruct
  public void postConstruct() {
    try {
        InitialContext ctx = new InitialContext();
        log = (ExternalLoggerLocal) ctx.lookup(&quot;mybindings/Logger&quot;);
    } catch (NamingException e) {
        e.printStackTrace();
    }
  }

  public boolean log(String str) {
    if (log != null) {
      log.log(str);
      return true;
    }

    return false;
  }

}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;@Stateless
public class BusinessService implements BusinessServiceLocal {

  @EJB
  LoggerFacadeLocal logger;

  public String doSomeImportantStuff() {
    logger.log(&quot;Running doSomeImportantStuff()&quot;);
    return &quot;Done&quot;;
  }

}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;The ExternalLogger might (and that’s our case) deployed as a separate module (in a different ear file). It uses vendor specific annotation (from Jboss), @LocalBinding – to hook the service under a specific name within the JNDI index. That way, the façade can lookup the logging service in a flexible way and fall back when no implementation is deployed. If @EJB annotation was used, unsatisfied dependency would have ended up in throwing an exception – which we wanted to avoid. Façade is directly used in the application.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Obviously, the implementation shown in the examples is quite naïve but I hope it describes the problem we were facing and how it was solved.
Despite the simplicity, this is a fully working application (JBoss 4.2.x deployable).&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;the-tests-problems&quot;&gt;The tests problems&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Implementation of business logic is always only one side of the story. The other are tests and a way to cover the above logic with some reasonable tests cases. We were using OpenEJB with ApplicationComposer quite extensively and it helped us a lot in writing focused integration testing. Nonetheless, it occurred to be limited and unable to test this particular case.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Testing the negative case (the logger not deployed) was fairly simple, no bean implementing ExternalLogger interface was deployed.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;@RunWith(ApplicationComposer.class)
public class NoActiveLoggerTest {

  @EJB
  LoggerFacadeLocal facade;

  @Module
  public EjbJar beans() {
    EjbJar ejbJar = new EjbJar(&quot;loggging-app&quot;);
    ejbJar.addEnterpriseBean(new StatelessBean(LoggerFacade.class));
    return ejbJar;
  }

  @Test
  public void facadeReturnsFalseOnNoActiveLogger() {
    assertFalse(facade.log(&quot;Echo&quot;));
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Testing the successful wiring of the logger was much more troublesome. It appeared there is no way to define a specific JNDI location for a component. There were ways to do it using openejb-jar.xml file but we wanted to avoid it and handle everything within the test class, as it proved to be more maintainable.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;A way for us to go was to modify the ApplicationComposer itself. Without getting much into details how the runner works (you can learn more about it from &lt;a href=&quot;/posts/2011/07/01/testing-ejb-application-openejb-without-classpath-scanning/&quot;&gt;my previous posts&lt;/a&gt; or from the &lt;a href=&quot;http://ci.apache.org/projects/openejb/examples-generated/application-composer/&quot;&gt;OpenEJB documentation&lt;/a&gt;) we were not able to output the configuration that included a specific JNDI location of a bean. Methods annotated with @Module could return EjbJar type of class, but we needed to get a level up, define a whole module with a specific JNDI. As I mentioned earlier, Greg had this idea to modify the ApplicationComposer class (which appeared to be fairly easy). The positive test case worked fine:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;@RunWith(ApplicationComposer.class)
public class ActiveLoggerTest {

  @EJB
  LoggerFacadeLocal facade;

  @Module
  public EjbModule module() {
    EjbJar ejbJar = new EjbJar(&quot;loggging-app&quot;);
    ejbJar.addEnterpriseBean(new StatelessBean(LoggerFacade.class));
    ejbJar.addEnterpriseBean(new StatelessBean(ExternalLogger.class));

    EjbModule ejbModule = new EjbModule(ejbJar, new OpenejbJar());
    EjbDeployment deployment =
      new EjbDeployment(new StatefulBean(ExternalLogger.class));
    deployment.getJndi().add(new Jndi(&quot;mybindings/Logger&quot;, &quot;Local&quot;));
    ejbModule.getOpenejbJar().addEjbDeployment(deployment);

    return ejbModule;
  }

  @Test
  public void facadeReturnsTrueOnActiveLoggerPresent() {
    assertTrue(facade.log(&quot;Echo&quot;));
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;The output was exactly as expected:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre&gt;INFO - Jndi(name=LoggerFacadeLocal) --&amp;gt; Ejb(deployment-id=LoggerFacade)
INFO - Jndi(name=mybindings/Logger) --&amp;gt; Ejb(deployment-id=ExternalLogger)&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;the-modifications&quot;&gt;The modifications&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;I understand that made a very specific case, which was the reason not to include it in the original runner’s code. However, as it worked for us, it might work for you as well. The patch is submitted to OpenEJB – wonder if it gets accepted (see: &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENEJB-1763&quot; class=&quot;bare&quot;&gt;https://issues.apache.org/jira/browse/OPENEJB-1763&lt;/a&gt;)&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
        <pubDate>Sat, 04 Feb 2012 00:00:00 +0000</pubDate>
        <link>http://jakub.marchwicki.pl/posts/2012/02/04/testing-ejb-application-openejb-test-and-custom-jndi-lookups/</link>
        <guid isPermaLink="true">http://jakub.marchwicki.pl/posts/2012/02/04/testing-ejb-application-openejb-test-and-custom-jndi-lookups/</guid>
        
        
        <category>posts</category>
        
      </item>
    
      <item>
        <title>Map Reduce is not about frameworks</title>
        <description>&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;When one performs a Google search for “map reduce”, the results are usually full of frameworks: Hadoop, MangoDB, Map Redcude in Amazon Elastic… and some wikipedia articles. All those frameworks support processing of massive data sets in a ditributed fashion. But map reduce is not about framework, neither about libraries that can be included in an application nor any deployable platform (infrastructure). At least not only about these. In my opinion map reduce is more about an approach, an architecture which can be implemented in a distributed environment – not necessarily using one of the mentioned frameworks. In this post I’ll describe how I used a concept of map reduce to process a massive amount sets among multiple nodes, in an asynchronous, distributed fashion.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;so-what-map-reduce-is&quot;&gt;So, what map reduce is?&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;quoteblock&quot;&gt;
&lt;blockquote&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;MapReduce is a programming model and an associated implementation for processing and generating large data sets. Users specify a map function that processes a key/value pair to generate a set of intermediate key/value pairs, and a reduce function that merges all intermediate values associated with the same intermediate key. &lt;span class=&quot;footnote&quot; id=&quot;_footnote_mapreduce&quot;&gt;[&lt;a id=&quot;_footnoteref_1&quot; class=&quot;footnote&quot; href=&quot;#_footnote_1&quot; title=&quot;View footnote.&quot;&gt;1&lt;/a&gt;]&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;attribution&quot;&gt;
&amp;#8212; MapReduce: Simplified Data Processing on Large Clusters
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;This is Google’s definition, where MapReduce was invented. If that definition isn’t clear enough, Joel Spolsky wrote a great article &quot;Can your programming language do this?&quot; &lt;span class=&quot;footnote&quot;&gt;[&lt;a id=&quot;_footnoteref_2&quot; class=&quot;footnote&quot; href=&quot;#_footnote_2&quot; title=&quot;View footnote.&quot;&gt;2&lt;/a&gt;]&lt;/span&gt; where here explains how this all works. I can’t disagree with what Joel wrote – “Without understanding functional programming, you can’t invent MapReduce &lt;span class=&quot;footnoteref&quot;&gt;[&lt;a class=&quot;footnote&quot; href=&quot;#_footnote_1&quot; title=&quot;View footnote.&quot;&gt;1&lt;/a&gt;]&lt;/span&gt;, the algorithm that makes Google so massively scalable. The terms Map and Reduce come from Lisp and functional programming.” Nonetheless, this is not only about language capabilities and it’s definitely not about frameworks. MapReduce can be also considered from an architecture and infrastructure perspective. A massive scalability can be achieved by distributing work among nodes. Without functional programming it won’t be massively flexible, but at the moment scalability was aimed.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;some-background&quot;&gt;Some background&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;The project which I’m involved in is a suite of SOAP web services, written in EJB3, deployed on a JBoss 4.2.x application server – first one to support JEE5 (to some extent). The diagram below briefly outlines the overall infrastructure.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;imageblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;img src=&quot;data:image/png;base64,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&quot; alt=&quot;Implementation view for map reduce&quot; width=&quot;720&quot; height=&quot;266&quot;&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;There are multiple independent nodes, which are proxied by loadbalancer, to provide an even traffic distribution for each of the nodes. Underneath the application layer, there is a shared database for all the nodes. The database has it’s own replication and balancing capabilities and details of that are beyond the scope of this post. The mentioned database is primarily for business data, while any realtime information (like JMS messaging, processing data) are persisted within a local, Hypersonic database – to minimize the load on the main data stores and network contingency. The architecture can be summarized as horizontally scalable through replication (simply adding more nodes).
This infrastructure evolved and was optimized overtime to address the main requirement: fastest possible, realtime processing of a single piece of information. This processing included both drilling down our own database, as well as decorating response data with some additional information, provided by a suite of external services (with additional webservice calls). With time our system evolved into a single ‘point-of-contact’ facade for quite a significant number of external services. That brings us to the latest requirement and indirectly to MapReduce.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;substituting-batch-processing-with-webservices&quot;&gt;Substituting batch processing with webservices&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;One of the many external service which we’ve been utilizing in our solution, was also manually processed in a batch fashion; an email with CSV data was sent and the receiving party processed the data. Our solution has been doing pretty much the same, but for a single data item. Extending the system capabilities to process multiple rows, to substitute the quasi manual process seemed to be a natural evolution and that was the main objective for the project. The ‘multiple’ factor was quite scarry – up to few million records in a single process. The decision was to utilize all of the nodes, but in a more parallel fashion. What was needed was a way for robust asynchronous processing of the data and collecting the results, utilize the nodes (which are quite powerful boxes) in a maximum way and keep the load on any other machine as low as possible. That brings us to Map Reduce.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;map-reduce-is-everywhere&quot;&gt;Map Reduce is everywhere&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;So, for Map Reduce we need two things: a mapper and a reducer. In case of the described solution, the map is a simple perl script, which splits an incoming flat file into multiple chunks (not to kill a single node with all requests). The script assigns an unique process id, which as attached to the processing data. Each chunk is independently sent, through load-balancer, to any of the nodes. That triggers asynchronous processing.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;The ‘service gateway’ is a REST webservice – to keep it simple, straightforward and to minimize the network traffic (an alternative was SOAP). I still plan to describe deployment of RESTful web services with JBoss 4.x (which is an infrastructure I’m working with) at some point in the future. So far – it’s out of scope.
So that is the mapper. What’s still needed is a reducer. All the services use a shared database underneath. All business critical information as stored there. It’s a clustered RDMS and is performing pretty well. That way, database become the reducer. After asynchronous processing the data (calling an external service, processing and analysing the response), the data is persisted into the database. It is easy to retrieve the data with the unique, upfront generated id.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;some-conclusions&quot;&gt;Some conclusions&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;The environment which is used is definitely not the latest, most cutting edge technology stack. Well, JBoss 4.2.x with Java 5 is far better than Java 1.3, but it is still not something most developers are keen on working with. Though the technology stack is not our choice and there is no way to change it or upgrade (you probably know the ‘corporate ideas’ of technology freeze – that’s the case), it’s not always a dead end. There are always things to push forward and boxes to think outside of. Many new, cutting edge ideas can be implemented at the top of ‘not-so-modern’ technology stack. It always require a little more wiring, some boilerplate code than an out-of-the-box framework, but it’s almost always worth it. After all, the fun factor is always important even in a daily job.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;div class=&quot;footnote&quot; id=&quot;_footnote_1&quot;&gt;
&lt;a href=&quot;#_footnoteref_1&quot;&gt;1&lt;/a&gt; &lt;a href=&quot;http://labs.google.com/papers/mapreduce.html&quot; class=&quot;bare&quot;&gt;http://labs.google.com/papers/mapreduce.html&lt;/a&gt;
&lt;/div&gt;
&lt;div class=&quot;footnote&quot; id=&quot;_footnote_2&quot;&gt;
&lt;a href=&quot;#_footnoteref_2&quot;&gt;2&lt;/a&gt; &lt;a href=&quot;http://www.joelonsoftware.com/items/2006/08/01.html&quot; class=&quot;bare&quot;&gt;http://www.joelonsoftware.com/items/2006/08/01.html&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
        <pubDate>Tue, 20 Sep 2011 00:00:00 +0000</pubDate>
        <link>http://jakub.marchwicki.pl/posts/2011/09/20/map-reduce-is-not-about-frameworks/</link>
        <guid isPermaLink="true">http://jakub.marchwicki.pl/posts/2011/09/20/map-reduce-is-not-about-frameworks/</guid>
        
        
        <category>posts</category>
        
      </item>
    
      <item>
        <title>(…) testing EJB application – Part V (OpenEJB without classpath scanning)</title>
        <description>&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;I’ve recently come across &lt;a href=&quot;http://blog.thecodewhisperer.com/2010/10/16/integrated-tests-are-a-scam/&quot;&gt;a very good article on integrated testing&lt;/a&gt; (with a provocative title: Integrated Test Are a Scam). The writing basically question most of my efforts and the sense of this series (as a whole) – integrated tests are bad and you should rather avoid doing it. Unit tests rocks. I cannot agree more. However, as J.B. points out there are moments when an integrated test brings some value (whew, the series saved). An this is where tools like OpenEJB proves its value. On the other hand, the way OpenEJB works pushes the user to end-to-end integration testing – SCAM!&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;the-biggest-openejb-disadvantage&quot;&gt;The biggest OpenEJB disadvantage&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Yeah, the necessity of the end-to-end testing is the biggest drawback of OpenEJB. It’s not easy to bootstrap a part of the containter (which I think I’ve shown &lt;a href=&quot;/posts/2011/06/29/testing-ejb-application-openejb-with-vendor-extensions-and-ejb-jar-xml/&quot;&gt;in the previous write-up&lt;/a&gt;). I found it close to impossible to be selective about which service gets deployed, which effectively means you cannot test half-baked code. If the whole application does not wire together (because the development is still in progress – for example), container does not boot, test fails (even though what’s tested is a completely independent area). This effectively makes the tools useless, when your development is test driven.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;See the example of the persistence.xml, from &lt;a href=&quot;/posts/2011/06/09/the-art-of-testing-an-ejb-application-openejb/&quot;&gt;the first OpenEJB part&lt;/a&gt; – even though the database was not used in the test, a decent effort was required just to make it working. That’s what I’m tacking about and that’s the essence of the J.B.’s “Integrated Tests Are A Scam” article – hell a lot of effort is wasted in getting the stuff working, maintaining, before the actual tests are even written. This is not – in any case – critique of OpenEJB. As I wrote earlier, it’s a great tool but it looks like the way I was trying to use it was not exactly the fit for purpose. Now I know, an embeddable container for tests was the primary objective of creators, probably not. That’s why I started to think about something more tests oriented. One idea was &lt;a href=&quot;http://www.jboss.org/arquillian&quot;&gt;Arquillian&lt;/a&gt;; the other was to push OpenEJB harder, post questions to OpenEJB Users group, contact developers (as I’ve mentioned at the end of the last post – &lt;a href=&quot;http://openejb.979440.n4.nabble.com/override-annotation-based-configuration-with-ejb-jar-xml-td3628804.html&quot;&gt;see the discussion @ nabble.com&lt;/a&gt;). The later option appeared to be more agile’ish and with help from David Blevins, I found ways to test EJB without deploying the whole container. After all, it was easier to re-use that knowledge than get hands dirty with yet another technology and framework.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;focused-integration-testing&quot;&gt;Focused integration testing&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;I think this is a bit I’ve been missing so far. A few helper classes have been introduced in OpenEJB 3.1.4 so first of all pom upgrade is required. Additionally, this is a fairly new functionality and core library only supports JUnit. As you could’ve seen in the examples – I’ve opted for the TestNG framework which works slightly different. An integration for TestNG is already in place, but unfortunately not yet committed (see &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENEJB-1526&quot;&gt;the JIRA ticket for that&lt;/a&gt;). Anyway, after adding AbstractOpenEJBTestNG class to the application, the test class looks like that&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;public class MethodControllerTest extends AbstractOpenEJBTestNG {

  @EJB
  MethodControllerLocal controller;

  @Module
  public EjbJar beans() {
    EjbJar ejbJar = new EjbJar(&quot;calculation-beans&quot;);
    ejbJar.addEnterpriseBean(new StatelessBean(TestingDisplayingService.class));
    ejbJar.addEnterpriseBean(new StatelessBean(CalculatingService.class));
    ejbJar.addEnterpriseBean(new StatelessBean(MethodController.class));
    return ejbJar;
  }

  //... some test methods
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Lovely, isn’t it? AbstractOpenEJBTestNG is not fully compliant with 3.1.4 version so some fine-tuning is necessary. If you need it badly for your tests (and I assume so – if you are reading this) – take the one from my probject on github: &lt;a href=&quot;https://github.com/kubamarchwicki/ejb-testing/blob/app-composer/ejb/src/test/java/org/apache/openejb/testng/AbstractOpenEJBTestNG.java&quot;&gt;AbstractOpenEJBTestNG&lt;/a&gt;. Everything works like a charm- happy days.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;finally&quot;&gt;Finally&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;To be honest, this is something I’ve been looking for. This is where OpenEJB and Arquillian worlds meet each other. As David Blevins pointed out: “(This is) how we write our internal tests and is a big influence on Arquillian — OpenEJB was a pretty critical part of Arquillian when they were first getting it going”.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Additionally, besides all the advantages outlined above (robustness, easiness etc), all my integration tests run much faster. Maybe it’s not clearly visible in the example application, where tests are small, but in real life app (like the one I’m working with currently) it’s a significant improvement. ‘The big project’ I’m working on, where I also implemented the described approach, builds now significantly faster. There is no need to scan classpath, handle persistence context for each and every test. I think we are now talking about truly focused integration testing.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;PS. If you are looking for core JUnit examples, Application Composer example from OpenEJB is pretty nifty: &lt;a href=&quot;http://people.apache.org/~dblevins/application-composer/&quot; class=&quot;bare&quot;&gt;http://people.apache.org/~dblevins/application-composer/&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;PS2. The complete source code is available on my github account: &lt;a href=&quot;https://github.com/kubamarchwicki/ejb-testing/tree/app-composer&quot; class=&quot;bare&quot;&gt;https://github.com/kubamarchwicki/ejb-testing/tree/app-composer&lt;/a&gt;. All the EJB examples have been refactored to utilise the ‘application composer’ approach. I hope you find it helpful&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
        <pubDate>Fri, 01 Jul 2011 00:00:00 +0000</pubDate>
        <link>http://jakub.marchwicki.pl/posts/2011/07/01/testing-ejb-application-openejb-without-classpath-scanning/</link>
        <guid isPermaLink="true">http://jakub.marchwicki.pl/posts/2011/07/01/testing-ejb-application-openejb-without-classpath-scanning/</guid>
        
        
        <category>posts</category>
        
      </item>
    
      <item>
        <title>(…) testig an EJB application – Part IV (OpenEJB with vendor extensions and ejb-jar.xml)</title>
        <description>&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;&lt;a href=&quot;/posts/2011/06/09/the-art-of-testing-an-ejb-application-openejb/&quot;&gt;The previous post of EJB testing featured OpenEJB bootstrapping and handling different configurations&lt;/a&gt; (or better say overwriting the defaults). This time I want to focus on vendor extensions, which are not supported by OpenEJB and ways to include them in the testing context. This way I’ll tackle ejb-jar.xml files, which can provide alternate dependencies for beans in context. I’ll iterate over a sample application which is available on &lt;a href=&quot;https://github.com/kubamarchwicki/ejb-testing&quot;&gt;github&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;the-wider-context&quot;&gt;The wider context&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;I’ve already mentioned I’m using JBoss and the vendor extension which I’m referring to is a @Service annotation. JBoss does not support a @Singleton EJB annotation and @Service is supposed to be an alternative (this refers to versions 4.x and 5.x – I haven’t tested it, but I suppose @Singleton annotation works fine in JBoss6). I’ve been using JBoss @Services for two reasons: managed configuration beans and basic cache. The big advantage of a managed-bean service is that there will be only one instance of the service bean (no pooling) so the instance is effectively a singleton. That way the bean’s shared state is accessible by other clients. This is important to remember because it’s not always a desired behaviour.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;To put this in context of the sample-example application, lets assume an interface to our calculator application is a custom, concatenated string, which needs to be parsed (if you need a reason, let’s say we are running service manually from the jmx-console). The parser we are using works very quickly, but the initialization takes long enough to be worried about the run-time performance (quite a common non-functional requirement when a Dozer Mapper or Hibernate Validator is used – initialization takes some time). Using a service to initialize it on startup does not seem such a bad idea. Additionally, there is a requirement to change some of the configuration properties in run-time. In our particular case, the configuration is used for a flexible customizing the display. A configuration managed bean will be used to fulfil this ‘requirement’.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;services&quot;&gt;Services&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;First of all, before we even get to building a service, appropriate dependencies need including. @Service is a vendor extension so a jboss jar needs referencing:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&amp;lt;dependency&amp;gt;
  &amp;lt;groupId&amp;gt;jboss&amp;lt;/groupId&amp;gt;
  &amp;lt;artifactId&amp;gt;jboss-annotations-ejb3&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;That way access to @Service and @Management annotations is available. Building a singleton bean is as easy as adding those two annotations to a desired class:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;@Service(objectName=&quot;pl.marchwicki.view.settings:service=displaySettings&quot;)
@Management(DisplaySettingsMBean.class)
public class DisplaySettings implements DisplaySettingsMBean {
  //... business methods
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Another important note: while in case of setting mbean we don’t need to any additional lifecycle methods in the interface (like start, stop, create, destroy), in case of caching bean, a start() method is very helpful. At some point of the lifecycle the mapper needs initialization. In normal EJB environment it would be @PostConstruct, but as we are using vendor specific extensions it all works slightly different. What would have normally been put to @PostConstruct, gets executed in start() method.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;successful-deployment&quot;&gt;Successful deployment&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;When the application is built and deployed we see following information in the log file (acknowledging successful deployment):&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre&gt;INFO  [EJBContainer] STARTED EJB: pl.marchwicki.ejb.frontend.StringToArrayMappingService
    ejbName: StringToArrayMappingService
INFO  [Mapper] Mapper initialized
INFO  [StringToArrayMappingService] Mapper set
INFO  [EJBContainer] STARTED EJB: pl.marchwicki.ejb.view.configuration.DisplaySettings
    ejbName: DisplaySettings&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Now, it’s possible to invoke the add() method from calculationFacade service, from the jmx-console. With argument “1;2;3;4” we see appropriate result in logs:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre&gt;INFO  [STDOUT] : Result of ADD operation is: 10&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;It’s also possible to change the display template (in the displaySettings bean), so the result looks slightly different:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre&gt;INFO  [STDOUT] @@@@@ Result of ADD operation is: 10&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Everything works fine… however, describing the nature of JBoss ‘singletons’ was not the objective for this post. It was supposed to be about testing.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;initializing-vendor-specific-beans-in-tests&quot;&gt;Initializing vendor specific beans in tests&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;I must admit there was a little trick – I’ve been running maven with the skip-tests flag set. I wanted to show the application is running on the application server, to emphasize the differences and issues with OpenEJB for testing. When the tests are run, the build fails (even though everything works smooth on the server):&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre&gt;WARN - Unresolved ejb reference
   &quot;pl.marchwicki.ejb.view.DisplayingService/settings&quot; in bean
   &quot;DisplayingService&quot;.  Will attempt resolution again at runtime.
WARN - Injection data not found in enc:
   jndiName=&#39;pl.marchwicki.ejb.view.DisplayingService/settings&#39;,
   target=class pl.marchwicki.ejb.view.DisplayingService/settings&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;OpenEJB is unable to resolve the managed beans. No surprise – these are JBoss services afterall. Now it’s time for manual setup, with an ejb-jar.xml. First of all – we need to handle DisplaySettings by defining the bean as follows:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;
&amp;lt;ejb-jar&amp;gt;
  &amp;lt;enterprise-beans&amp;gt;
    &amp;lt;session&amp;gt;
      &amp;lt;ejb-name&amp;gt;DisplaySettings&amp;lt;/ejb-name&amp;gt;
    &amp;lt;business-local&amp;gt;pl.marchwicki.ejb.view.configuration.DisplaySettingsMBean&amp;lt;/business-local&amp;gt;
      &amp;lt;ejb-class&amp;gt;pl.marchwicki.ejb.view.configuration.DisplaySettings&amp;lt;/ejb-class&amp;gt;
      &amp;lt;session-type&amp;gt;Stateless&amp;lt;/session-type&amp;gt;
      &amp;lt;env-entry&amp;gt;
        &amp;lt;description&amp;gt;Display template&amp;lt;/description&amp;gt;
        &amp;lt;env-entry-name&amp;gt;setDisplayTemplate&amp;lt;/env-entry-name&amp;gt;
        &amp;lt;env-entry-type&amp;gt;java.lang.String&amp;lt;/env-entry-type&amp;gt;
        &amp;lt;env-entry-value&amp;gt;------- {} -------&amp;lt;/env-entry-value&amp;gt;
        &amp;lt;injection-target&amp;gt;
	          &amp;lt;injection-target-class&amp;gt;pl.marchwicki.ejb.view.configuration.DisplaySettings&amp;lt;/injection-target-class&amp;gt;
          &amp;lt;injection-target-name&amp;gt;setDisplayTemplate&amp;lt;/injection-target-name&amp;gt;
        &amp;lt;/injection-target&amp;gt;
      &amp;lt;/env-entry&amp;gt;
    &amp;lt;/session&amp;gt;
  &amp;lt;/enterprise-beans&amp;gt;
&amp;lt;/ejb-jar&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;After that, the application builds successfully, tests run smoothly and an expected message shows up in the console (formatted as defined).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre&gt;------- Result of ADD operation is: 10 -------&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;The caching service can be handled in a very similar way. Starting with a test, which obviously fails:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;public class CalculationFacadeTest {

  CalculationFacadeLocal facade;

  @BeforeClass
  public void setup() throws NamingException {
    InitialContext ctx = new InitialContext();
    facade = (CalculationFacadeLocal) ctx.lookup(&quot;CalculationFacadeLocal&quot;);
  }

  @Test
  public void simpleAdding() {
    String args = &quot;1;2;3;4&quot;;
    String calculate = facade.add(args);
    Assert.assertEquals(&quot;200 OK&quot;, calculate);
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre&gt;FAILED CONFIGURATION: @BeforeClass setup
    javax.naming.NameNotFoundException: Name &quot;CalculationFacadeLocal&quot; not found.&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;OpenEJB does not handle out service annotation so a similar approach with ejb-jar.xml is required. Definition is fairly simple, so after adding both services to context… the test fails again – but more gracefully.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre&gt;Caused by: java.lang.NullPointerException
    at pl.marchwicki.ejb.frontend.StringToArrayMappingService.map(StringToArrayMappingService.java:18)&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;The cached mapper needs manual initializing – not surprise. We can add this extra step into @BeforeClass method of the test (lookup the bean in the context and manually run the start() method) and voila! Build successful. Surprising is that OpenEJB does not call create() method on startup – even though it says so in the logs.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;beyond-initialization&quot;&gt;Beyond initialization&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Simple initialization is not the only useful thing about ejb-jar.xml. Let’s say we aim to mock some services – take DisplayingService. As the ‘sophisticated templates’ are not required for tests, so let’s replace them with a simplest possible implementation – displaying results to console without any formatting. As you could have noticed, OpenEJB does not give you much flexibility in what to use. Classpath is scanned, beans are created. What is more, OpenEJB does not care much if more than one implementation of the business interface is present in context. The first one is picked and wired (which I can accept to some extent). It gets worse when the application consists of multiple ears which all get wrapped into single ear on tests. After that it’s impossible to tell which implementation is used.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;So let’s create additional implementation of DisplayingServiceLocal. Unfortunately, even though additional bean is discovered, it’s successfully deployed – still the default implementation is used. There is no way to tell, which implementation is going to be picked up by the container (and there is not way to tell the container to pick a desired implementation).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;One solution is to directly reference an instance with beanName attribute within the @EJB annotation. Works like a charm, however I don’t think it’s a good practice to change the application logic to have tests running smoothly.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Another, in my opinion an intuitive approach would be to use ‘after-everything-is-setup’ configuration file, override dependencies and manually wire appropriate beans. Unfortunately, that’s not possible (at least I haven’t found a way to do it). Even if alternate deployment descriptors are defined (as described in &lt;a href=&quot;http://openejb.apache.org/3.0/alternate-descriptors.html&quot;&gt;alternate descriptors manual page of OpenEJB&lt;/a&gt;), only the first one is loaded (other are ignored). Manual wiring (of MethodController – for example) in ejb-jar.xml results with NullPointerException (cause classpath discovery is performed latter). On the other hand, a full initialization of bean in ejb-jar.xml results with a nasty javax.naming.NameAlreadyBoundException (when the classpath is scanned).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;I gave up. Posted question to a mailing list – see what happens. Made myself some more room to try something else – Arquillian.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;some-conclusions&quot;&gt;Some conclusions&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Probably after reading all these you think OpenEJB is an overkill, a fairly complicated and not easy to use tool. I can bet you are close to give up testing (at least integration) because ‘there is now way to do it efficiently and I’ll just click the app through’. Well, you are not the first one. I’ve been there as well, nearly giving up. After a while (and a decent drilling down) I’d withdraw my initial pessimism. I agree OpenEJB is not the best tool for testing – but that’s better than nothing (fanboys note: I’ll be covering Arquillian later on – I’ve just written few seconds earlier). It works fine with end-to-end integration testing. On the other hand, the focused integration tests are fairly challenging (as you could’ve seen in this post). It all works fine a long as you are not trying to beat the game.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Final thoughts; the steps and tools I’ve described in this and previous posts saved me hours of booting and restarting application server. After a while I started to implement whole change requests without touching the application server. Nevertheless, I think it’s time to move on – in the next episode I plan to fork the existing code reimplement all the tests with Arquillian. Stay tuned!&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
        <pubDate>Wed, 29 Jun 2011 00:00:00 +0000</pubDate>
        <link>http://jakub.marchwicki.pl/posts/2011/06/29/testing-ejb-application-openejb-with-vendor-extensions-and-ejb-jar-xml/</link>
        <guid isPermaLink="true">http://jakub.marchwicki.pl/posts/2011/06/29/testing-ejb-application-openejb-with-vendor-extensions-and-ejb-jar-xml/</guid>
        
        
        <category>posts</category>
        
      </item>
    
      <item>
        <title>The art of testing an EJB application – Part III (OpenEJB)</title>
        <description>&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;In the last two posts I’ve introduced my approach to testing (both unit and integration) and shown few ways to test bits and pieces of an enterprise application (some naive as well as more mature). This part is dedicated to tests with a fully featured EJB container, bootstrapped by the test suit. I’ll be using OpenEJB, because I’ve been using it for last few weeks in my latest project. I’ll show some basics and cover some of the more troublesome bits and pieces (which were not covered in the documentation or were not that intuitive). I must admit starting with OpenEJB wasn’t easy; in fact it was fairly frustrating experience at some point (which could have been noticed &lt;a href=&quot;http://twitter.com/kubem&quot;&gt;in my tweets&lt;/a&gt;). It’s a great a tool, but the learning curve is steep. I’m focusing on OpenEJB cause I’ve been using is the extensively. Nonetheless, it’s not the only way to test EJB application end-to-end. Alternatives are Sping (which handles @EJB annotations pretty neatly) or Arquillian (which is another approach to bootstrap the container). I’ll try to cover the latter in some future posts, but as for now – let’s start with OpenEJB.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;There is one downside of OpenEJB – it bootstraps whole container and deploy all beans available in classpath. That’s not a desired behaviour in many cases. Arquillian seems to be more picky when it comes to beans for deployment. OpenEJB has some filtering capabilities as well – I’ll cover those later on in the series.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;For something completely different – I thought I’d rather avoid embedding small code snippets, so I decided to host a complete working project at my GitHub space: &lt;a href=&quot;https://github.com/kubamarchwicki/ejb-testing&quot; class=&quot;bare&quot;&gt;https://github.com/kubamarchwicki/ejb-testing&lt;/a&gt; – feel free to fork.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;hello-world-application&quot;&gt;Hello world! application&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;This is fairly easy – there are tons of dummy EJB examples. However, I don’t like when examples are too abstract so lets assume we are building a calculator application, with services responsible for calculations and some for printing the results, etc.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;public interface CalculatingServiceLocal {
   public int add(int... args);
   public int subtract(int... args);
   public int multiply(int... args);
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;public interface MethodControllerLocal {
   public enum Operator {ADD, SUBTRACT, MULTIPLY};
   public String calculate(Operator operation, String... args);
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;To test this application we need to add two things to project and write the actual test. First of all it’s required to include OpenEJB in our application, in test scope.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.apache.openejb&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;openejb-core&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;3.1&amp;lt;/version&amp;gt;
    &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;
&amp;lt;/dependency&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;The actual test looks like this:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;public class MethodControllerTest {

   MethodControllerLocal controller;

   @BeforeClass
   public void setup() throws NamingException {
       InitialContext ctx = new InitialContext();
       controller = (MethodControllerLocal) ctx
               .lookup(&quot;MethodControllerLocal&quot;);
   }

   @Test
   public void notSupportedOperation() {
       String calculate = controller.calculate(Operator.MULTIPLY,
               new String[] { &quot;1&quot;, &quot;2&quot; });
       Assert.assertEquals(&quot;501 Not Implemented&quot;, calculate);
   }

   //... more test methods
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;For this to successfully run, we need to instruct OpenEJB on how to perform the classpath discovery (see &lt;a href=&quot;http://openejb.apache.org/3.0/application-discovery-via-the-classpath.html&quot;&gt;OpenEJB application discovery via classpath manual&lt;/a&gt; for details). My personal preference is to use openejb.deployments.classpath.include and openejb.deployments.classpath.exclude as I find it more reliable that putting an empty ejb-jar.xml file in the classpath.
In most cases this works smoothly, with a little jinx: OpenEJB goes nuts when classpath entries contains spaces (so if you use Maven and your repository is located in “Documents and Settings” folder). Moving it to a space-free folder fixes the issue.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;beyond-a-dummy-testing&quot;&gt;Beyond a dummy testing&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;In most cases, most tutorials finish here: a working sample, which has nothing to do with a real life application. In my case it’s more about a working baseline to iterate upon – the day-to-day testing problems are much more complicated and require significantly more effort. There is a long list of problems which you can stumble upon when trying to test real life projects and I intend to cover at least some of those issue. To list a few I’ve encountered:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;including database in this equation (to test JPA named queries)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;getting access to an entity manager, to check what actually got persisted&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;using ejb-jar.xml to instantiate vendor specific dependencies (which are not supported by the OpenEJB – like managed beans)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;using ejb-jar.xml to inject different implementations (without changing the actual application code)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;adding-database-to-this-equation&quot;&gt;Adding database to this equation&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;This sounds like a fairly common use case; an enterprise application uses database underneath. I don’t want to test database, persisting etc – I’ll just start with adding it an application. Let’s assume we need to persist calculation results. To do this, we add a basic entity and persistence.xml file to our solution.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;@Entity
@Table(name = &quot;CALC_RESULTS_TB&quot;)
public class CalculationResult implements Serializable {

   private static final long serialVersionUID = -3706396749558191166L;

   @Id
   @Column(name = &quot;CALC_ID&quot;,
	unique = true, nullable = false,
	precision = 10, scale = 0)
   @GeneratedValue(generator = &quot;CALC_ID_SEQ&quot;)
   @SequenceGenerator(name = &quot;CALC_ID_SEQ&quot;, sequenceName = &quot;CALC_ID_SEQ&quot;)
   private long id;

   @Column(name = &quot;OPERATION&quot;)
   private String operation;

   @Column(name = &quot;ELEMENTS&quot;)
   private String elements;

   @Column(name = &quot;RESULT&quot;)
   private int result;

   //getters and setters
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;title&quot;&gt;persistence.xml&lt;/div&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;
&amp;lt;persistence version=&quot;1.0&quot; xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot;
	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
	xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/persistence
	http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd&quot;&amp;gt;
	 &amp;lt;persistence-unit name=&quot;ejb-testing-pu&quot; transaction-type=&quot;JTA&quot;&amp;gt;
    &amp;lt;provider&amp;gt;org.hibernate.ejb.HibernatePersistence&amp;lt;/provider&amp;gt;
    &amp;lt;jta-data-source&amp;gt;java:/DefaultDS&amp;lt;/jta-data-source&amp;gt;
    &amp;lt;class&amp;gt;pl.marchwicki.ejb.entity.CalculationResult&amp;lt;/class&amp;gt;
    &amp;lt;properties&amp;gt;
     &amp;lt;property name=&quot;hibernate.show_sql&quot; value=&quot;false&quot;/&amp;gt;
     &amp;lt;property name=&quot;hibernate.format_sql&quot; value=&quot;true&quot;/&amp;gt;
     &amp;lt;property name=&quot;hibernate.use_sql_comments&quot; value=&quot;true&quot;/&amp;gt;
     &amp;lt;property name=&quot;hibernate.dialect&quot;
		value=&quot;org.hibernate.dialect.Oracle9Dialect&quot;/&amp;gt;
     &amp;lt;property name=&quot;hibernate.cache.use_second_level_cache&quot; value=&quot;true&quot;/&amp;gt;
     &amp;lt;property name=&quot;hibernate.cache.use_query_cache&quot; value=&quot;true&quot; /&amp;gt;
     &amp;lt;property name=&quot;hibernate.cache.provider_class&quot;
		value=&quot;org.jboss.ejb3.entity.TreeCacheProviderHook&quot; /&amp;gt;
     &amp;lt;property name=&quot;treecache.mbean.object_name&quot;
		value=&quot;jboss.cache:service=EJB3EntityTreeCache&quot; /&amp;gt;
     &amp;lt;property name=&quot;hibernate.cache.region_prefix&quot; value=&quot;/ejb-testing&quot; /&amp;gt;
     &amp;lt;property name=&quot;hibernate.ejb.naming_strategy&quot;
		value=&quot;org.hibernate.cfg.DefaultComponentSafeNamingStrategy&quot;/&amp;gt;
    &amp;lt;/properties&amp;gt;
 &amp;lt;/persistence-unit&amp;gt;
&amp;lt;/persistence&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Now, let’s wrap it into an ear file and deploy onto JBoss (I’ve used JBoss 4.2.3 – I know it’s an old one, but I happened I had that one installed – so the choice was obvious). On JBoss it works like a charm:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre&gt;16:06:55,827 INFO  [EJBContainer]
          STARTED EJB: pl.marchwicki.ejb.view.DisplayingService ejbName: DisplayingService
16:06:55,842 INFO  [EJBContainer]
          STARTED EJB: pl.marchwicki.ejb.controllers.MethodController ejbName: MethodController
16:06:55,858 INFO  [EJB3Deployer]
          Deployed: [..] tmp4564005441996180815ear-0.0.1-SNAPSHOT.ear-contents/ejb-0.0.1-SNAPSHOT.jar
16:06:55,858 INFO  [EARDeployer]
          Started J2EE application:
          file:/C:/_projects/_servers/jboss-4.2.3.GA/server/default/deploy/ear-0.0.1-SNAPSHOT.ear&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Unfortunately, when tests are re-executed – everything fails. SNAFU – situation normal. First of all – JBoss uses Hibernate as an JPA implementation, OpenEJB does not (I assume OpenJPA – but I haven’t been using that one as well). Secondly, persistence.xml includes some more sophisticated caching configuration.OpenEJB manual is pretty helpful here: lookup &lt;a href=&quot;http://openejb.apache.org/3.0/configuring-persistenceunits-in-tests.html&quot;&gt;configuring persistence unit in tests&lt;/a&gt;. However, more fundamental question should be answered here: what’s better for testing – two separate configurations (production and tests) or sharing same configuration only tuning (overriding it) when required. I prefer the latter – not once I had problems because I forgot updating test configuration with new entities, which cause tests fail. I’d rather satisfy test dependencies (in test scope) and override specific production properties (those related to cache, but also showing fomatted SQL in tests is pretty handy).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Additionally, (a clear coder notice) the setup() method is becoming a little boated with configuration. This can be easily moved to a jndi.properties file in the src/test/resources folder (not only the test suits become more readable, it makes the configuration reusable as well). So the configuration file for the test suit looks like this:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre&gt;java.naming.factory.initial = org.apache.openejb.client.LocalInitialContextFactory

persistence unit
ejb-testing-pu.hibernate.cache.provider_class = org.hibernate.cache.EhCacheProvider
ejb-testing-pu.hibernate.hbm2ddl.auto = create-drop
ejb-testing-pu.hibernate.dialect = org.hibernate.dialect.HSQLDialect
ejb-testing-pu.hibernate.show_sql = true
ejb-testing-pu.hibernate.format_sql = true
ejb-testing-pu.hibernate.use_sql_comments = true
ejb-testing-pu.hibernate.jdbc.batch_size = 0

openejb.deployments.classpath.include = .*ejb-testing.*
openejb.descriptors.output = true&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Now OpenEJB works beautifully. Mission accomplished!&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre&gt;===============================================
    Default test
    Tests run: 3, Failures: 0, Skips: 0
===============================================&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;what-s-comming-next&quot;&gt;What’s comming next&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;I know, with this post I’ve only touched the surface of OpenEJB, but that’s just to begin with something bigger. In the next part I plan to tackle ejb-jar.xml – instantiation of vendor specific beans, not handled by the OpenEJB and injecting concrete implementation of a service (when more than one is available in a classpath).&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
        <pubDate>Thu, 09 Jun 2011 00:00:00 +0000</pubDate>
        <link>http://jakub.marchwicki.pl/posts/2011/06/09/the-art-of-testing-an-ejb-application-openejb/</link>
        <guid isPermaLink="true">http://jakub.marchwicki.pl/posts/2011/06/09/the-art-of-testing-an-ejb-application-openejb/</guid>
        
        
        <category>posts</category>
        
      </item>
    
      <item>
        <title>The art of testing an EJB application – Part II (mocking)</title>
        <description>&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;&lt;a href=&quot;/posts/2011/05/02/the-art-of-testing-an-ejb-application-part-i/&quot;&gt;The previous post on testing was more like an introduction&lt;/a&gt; – now it’s time for some real testing. While I’ve only touched the surface with unit-unit tests, I think functional testing needs a deeper drilling. Here we go!&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;service-encapsulation&quot;&gt;Service encapsulation&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Decoupling services (having one service dependent on others, that encapsulate bits and pieces of functionality) is a fairly good practices. This ties nicely with a dependency injection feature of an EJB container; beans get resolved, initiated – happy days. Surely, not only EJB container does it, but comparing CDI frameworks is not in scope of this post. It’s about focused integration testing so let me start with with a simple example – a business service utilizing the TrimService from the previous post. If we are trying to keep our tests quick and robust, we need to get into container’s shoes and perform dependency injection on our own – this is where the loosely coupling starts to be a little bit painful.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;@Stateless
public class BusinessService implements BusinessServiceLocal {
	  @EJB TrimServiceLocal trimService;
    public BusinessMethodResponse businessMethod(TransferObject obj) {
      //some logic
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;In this particular example the container does a fairly simple and straightforward job. Instantiating of this service is nothing extraordinary and there is nothing that should stop us doing the same during in tests.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;public class BusinessServiceTest {

  BusinessService businessService;

  @BeforeClass
  public void setup() {
    businessService = new BusinessService();
    businessService.trimService = new TrimService();
  }

  @Test
  public void successfulBusinessMethodForSpecificCase() {
    TransferObject obj = new TransferObject();
    //populate the object

    BusinessMethodResponse response = businessService.businessMethod(obj);
    Assert.assertNotNull(response);
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Please note that the trimService field does not have an explicit visibility defined, which make the field of package scope. If we keep tests in the same package as the service, we can fiddle with service’s fields without any reflection API magic.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Even though this can work quite smoothly, we are moving beyond unit testing (some might say some unit tests principles might be violated, because we check the behaviour of more than one class – TrimService is tested as well). I won’t be bothered about this; at some point it’s necessary to take a more holistic approach towards testing. That’s exactly what’s happening here: focused integration testing; a carefully curated set of features was chosen and tested in isolation. That way we can see how certain blocks of the application works in conjunction with other elements of the system. On the other hand, the tests are still kept relatively small and fast.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;mocking-services&quot;&gt;Mocking services&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;When the services are getting more and more complex, a simple initialization might appear troublesome, producing too much boilerplate code. There are ways to do it faster – with mockups. From two most popular mocking frameworks: EasyMock (&lt;a href=&quot;http://easymock.org/&quot; class=&quot;bare&quot;&gt;http://easymock.org/&lt;/a&gt;) and Mockito (&lt;a href=&quot;http://mockito.org/&quot; class=&quot;bare&quot;&gt;http://mockito.org/&lt;/a&gt;), I pick the latter. A quick glimpse over Mockito website should give a decent clue how it works and how it follows given-when-then principle.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;See an example – a configuration service which returns configuration codes from a database. A Hibernate named query is used to retrieve raw, persisted data and some additional stripping logic is applied. Given a following service,&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;@Stateless
public class ConfigService implements ConfigServiceLocal {

  @EJB
  CrudServiceLocal crudService;

  public List&amp;lt;String&amp;gt; getConfigCodes(String type) {
    List&amp;lt;FuncConfg&amp;gt; funcConfgResults =
      crudService.findByNamedQuery(&quot;FuncConfg.findByType&quot;, “type”, type);
    List&amp;lt;String&amp;gt; configCodes = //some additional processing
    return configCodes;
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;the process of mocking data and testing may look like this&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;public class ConfigServiceTest {

  ConfigService configService;

  @BeforeClass
  public void setup() {
    configService = new ConfigService();
    configService.crudService = Mockito.mock(CommonCrudService.class);
  }

  @Test
  public void defaultTypeConfig() {
    final String deafultType = “defaultType”;
    Mockito.when(configService.crudService
        .findByNamedQuery(&quot;FuncConfg.findByType&quot;, “type”, defaultType))
        .thenReturn(defaultFuncConfgList());

    List&amp;lt;String&amp;gt; confgCd = configService.getConfigCodes(defaultType);
    Assert.assertNotNull(confgCd);
    Assert.assertEquals(confgCd.size(), 10);
    //some additional assertions
  }

  private List&amp;lt;FuncConfg&amp;gt; defaultFuncConfgList() {
    //creates default list of codes
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sect1&quot;&gt;
&lt;h2 id=&quot;handling-database&quot;&gt;Handling database&lt;/h2&gt;
&lt;div class=&quot;sectionbody&quot;&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Last, but not least – ‘talking’ to a database. This is getting us closer to an end-to-end integration testing – though the tests are still fairly robust, small and fast. In fact, what is happening here is pretty much the same what OpenEJB does when it bootstraps a database, but faster.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;I use this approach in two scenarios: when I want to test named queries against real data and when a snapshot of a production / test database is available and can be loaded from file, instead of handcrafting and mocking each data object individually.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Let’s use the previous example of the configuration service. Mocking the crud service worked perfectly fine, but when the number of different test cases increases significantly, quite a lot of test code needs to be written. There are smarter ways to do it. In my projects I tend to use this DataSourceMockUp class which bootstraps hibernate and exposes the EntityManager.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;public class DataSourceMockUp {

  private EntityManager entityManager;

  public DataSourceMockUp(Builder builder) {
    //bootstrap hibernate
    Ejb3Configuration config = new Ejb3Configuration();
    config.setProperty(&quot;hibernate.dialect&quot;, &quot;org.hibernate.dialect.HSQLDialect&quot;)
        .setProperty(&quot;javax.persistence.transactionType&quot;, &quot;RESOURCE_LOCAL&quot;)
        .setProperty(&quot;hibernate.connection.driver_class&quot;, &quot;org.hsqldb.jdbcDriver&quot;)
        .setProperty(&quot;hibernate.connection.url&quot;, &quot;jdbc:hsqldb:mem:testdb&quot;)
        .setProperty(&quot;hibernate.connection.username&quot;, &quot;sa&quot;)
        .setProperty(&quot;hibernate.connection.password&quot;, &quot;&quot;)
        .setProperty(&quot;hibernate.connection.pool_size&quot;, &quot;1&quot;)
        .setProperty(&quot;hibernate.connection.autocommit&quot;, &quot;true&quot;)
        .setProperty(&quot;hibernate.cache.provider_class&quot;, &quot;org.hibernate.cache.HashtableCacheProvider&quot;)
        .setProperty(&quot;hibernate.hbm2ddl.auto&quot;, &quot;create&quot;)
        .setProperty(&quot;hibernate.show_sql&quot;, &quot;true&quot;);

    //add entities
    for (Class&amp;lt;?&amp;gt; clazz : builder.annotatedClass) {
      config.addAnnotatedClass(clazz);
    }

    //set up services
    //even though the method is deprecated - this is one to be used
    //https://forum.hibernate.org/viewtopic.php?f=10&amp;amp;t=966871
    EntityManagerFactory entityManagerFactory = config.createEntityManagerFactory();
    setEntityManager(entityManagerFactory.createEntityManager());

    //import initial data
    EntityTransaction tx = getEntityManager().getTransaction();
    tx.begin();

    SchemaExport schemaExport = new SchemaExport(config.getHibernateConfiguration());
    schemaExport.setImportFile(builder.importSqlFile);
    schemaExport.create(true, true);
    tx.commit();
  }

  public static class Builder {
    private String importSqlFile;
    private List&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt; annotatedClass = new ArrayList&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt;();

    public Builder fromSqlFile(String importSqlFile) {
      this.importSqlFile = importSqlFile;
      return this;
    }

    public Builder withAnnotatedClass(Class&amp;lt;?&amp;gt; clazz) {
      this.annotatedClass.add(clazz);
      return this;
    }

    public DataSourceMockUp build() {
      return new DataSourceMockUp(this);
    }
  }

  public void setEntityManager(EntityManager entityManager) {
    this.entityManager = entityManager;
  }

  public EntityManager getEntityManager() {
    return entityManager;
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;With a data source mocked, the test class looks like this&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;public class ConfigServiceTest {
  ConfigService configService;

  @BeforeClass
  public void setup() {
    DataSourceMockUp mockup = new DataSourceMockUp.Builder()
        .fromSqlFile(sqlLocation)
        .withAnnotatedClass(FuncConfg.class).build();

    CommonCrudService crudService = new CommonCrudService();
    crudService.entityManager = mockup.getEntityManager();

    configService = new ConfigService();
    configService.crudService = crudService;
  }

  @Test
  public void getConfigCodesForDefaultType() {
    List&amp;lt;String&amp;gt; codes = configService.getConfigCodes(“T”);
    Assert.assertNotNull(codes);
    //... and so on
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;One can argue that the same can be achieved with an OpenEJB. True, the whole container can be bootstrapped and all the services will be injected automatically (including the persistence context). However, as I’ve outlined in the first part of this series – the tests are categorised by the speed of execution and handcrafting hibernate with w pre-prepared SQL script is much faster that running the whole EJB container. What is more – it’s more hands on, errors are easier to spot and there is less magic going under the bonnet. As I am planning to show in the next post – things like error recovery, detailed configuration and so on are not 1, 2, 3 with OpenEJB. That’s why I find focused integration testing a compromise between simple unit testing and a holistic, end-to-end approach.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
        <pubDate>Fri, 06 May 2011 00:00:00 +0000</pubDate>
        <link>http://jakub.marchwicki.pl/posts/2011/05/06/the-art-of-testing-an-ejb-application-part-ii/</link>
        <guid isPermaLink="true">http://jakub.marchwicki.pl/posts/2011/05/06/the-art-of-testing-an-ejb-application-part-ii/</guid>
        
        
        <category>posts</category>
        
      </item>
    
      <item>
        <title>The art of testing an EJB application – Part I (Introducing)</title>
        <description>&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;It has been a while since my last post – partly because the JMS processing project I’ve &lt;a href=&quot;about:blank&quot;&gt;described earlier on&lt;/a&gt; have kicked off and I was pretty busy with a real work. Nonetheless, the development is steadily coming to its end and it’s time to share some thought and observations. I’m still planning to cover the architecture – how and why it has changed, compared to the initial design I’ve described earlier on. However, for the time being I’ll focus on testing; I will describe some of ideas and observations how to approach testing of EJB 3.x services.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;This post is called “Part I” for a reason – there is a plan for multiple posts (so far I have a concept for three articles). The idea for the series came from &lt;a href=&quot;http://jamesshore.com/Blog/Alternatives-to-Acceptance-Testing.html&quot;&gt;James Shore article on acceptance testing&lt;/a&gt; where he introduces three kinds of tests: unit, focused integration and end-to-end integration. One of many factors to distinguish and categorise the tests is a number of tests to run (a rate per second). I pretty much like that idea and I’ve organised this series around that notion. First part – unit tests. It should not be anything new for people familiar with the TDD. With EJB 3.x testing is getting even easier because there are no special interfaces to implement and it’s easy to instantiate a session bean with a simple new operator. These are unit tests with expected rate of hundreds per second. In part two I’ll focus on integration testing of EJB services without a container. I’ll tackle mocking data and / or other services. These tests are expected to run with pace of tens per second. Finally, I’ll deal with an EJB container (with OpenEJB) and end-to-end integration tests. These are expected to take minutes per test (the container itself can take few minutes to bootstrap).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;That said, I’m not going to write much about the unit testing itself. Sorry if I haven’t met your expectations, but I don’t like to sound repetitive. Unit testing of an EJB service is not any different from testing any other bean. However, not to leave you with nothing, if you are not familiar with unit testing at all, here is a bunch of things to remember (formulated by Michael Feathers from www.objectmentor.com):&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;unit test does not talk to the database&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;unit test does not communicate across the network&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;unit test does not touch the file system&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;unit test does not require doing any special things to your environment (such as editing configuration files) to run it.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Next, check out &lt;a href=&quot;http://jamesshore.com/Blog/Lets-Play/Lets-Play-Test-Driven-Development.html&quot;&gt;James Shore screencast series “Let’s play TDD”&lt;/a&gt; to see what it’s all about.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Not to leave you without a line of code, here is a dummy example you can find across every second page. Let me show you a service which pre-process a set of data sent from an external service; it crawls an object (using reflection) and trims all non-final, not empty strings properties.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;public interface TrimServiceLocal {
  public void trimObject(Object o);
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;@Stateless
public class TrimService implements TrimServiceLocal {
  public void trimObject(Object o);
    //implementation goes here
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;So, the test looks simple as that:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;public class TrimServiceTest {

  TrimService trimService;

  @BeforeClass
  public void setup() {
    trimService = new TrimService();
  }

  @Test
  public removeWhitespaces() {
    Name name = new Name();
    name.setPrefix(“    Mr.”);
    name.setFirstname(“      John     “);
    name.setLastname(“Smith     “);

    trimService.trimObject(name);

    Assert.assertEquals(name.getPrefix(), “Mr.”);
    Assert.assertEquals(name.getFirstname(), “John”);
    Assert.assertEquals(name.getLastname(), “Smith”);
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;I’ll stop here and come back in the next few days with some thoughts on more advanced, integration testing.&lt;/p&gt;
&lt;/div&gt;</description>
        <pubDate>Mon, 02 May 2011 00:00:00 +0000</pubDate>
        <link>http://jakub.marchwicki.pl/posts/2011/05/02/the-art-of-testing-an-ejb-application-part-i/</link>
        <guid isPermaLink="true">http://jakub.marchwicki.pl/posts/2011/05/02/the-art-of-testing-an-ejb-application-part-i/</guid>
        
        
        <category>posts</category>
        
      </item>
    
      <item>
        <title>Building POJO in an elegant way</title>
        <description>&lt;div class=&quot;quoteblock&quot;&gt;
&lt;blockquote&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Any fool can write code that a computer can understand. Good programmers write code that humans can understand&lt;/p&gt;
&lt;/div&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;attribution&quot;&gt;
&amp;#8212; Martin Fowler - Refactoring: Improving the Design of Existing Code
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;In one of my recent projects I’ve come across a wonderful way of building data beans (POJOs), called builders. See how it works; imagine a fairly simple POJO.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;public class Person {
  private String name;
  private String surname;

  /* getters and setters skipped for brevity */
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;I can imagine two ways to instantiate this class and populate values:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;	Person person = new Person();
	person.setName(“John”);
	person.setSurname(“Smith”);

	new Person(“John”, “Smith”);&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;While with this fairly simple class it doesn’t look bad, with more complicated beans, the code starts to get messy.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;So here comes the smart way – with builders. For each POJO create an inner class:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;public class Person {
   private String name;
   private String surname;

   /* explicite constructors, getters and setters skipped */

   private Person(Builder builder) {
       this.name = builder.name;
       this.surname = builder.surname;
   }

   public static class Builder {
       private String name;
       private String surname;

       public Builder() {

       }

       public Builder withName(String name) {
           this.name = name;
           return this;
       }

       public Builder withSurname(String surname) {
           this.surname = surname;
           return this;
       }

       public Person build() {
           return new Person(this);
       }
   }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;So from now on creating instance of a Person looks like this&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;Person person = new Person.Builder()
  .withName(“John”)
  .withSurname(“Smith”)
  .build();&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Nice one, isn’t it? It gets even better when the object gets more complex. The only disadvantage I found so far was a necessity to hand craft all the builders – hundreds of pretty-much-same-lines-of-code. But what are templates for?&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Initially, I’ve considered internal Eclipse templates. Nice, but too simple and static (I couldn’t find a way to prepare dynamic templates, based on a class I was currently developing). Nonetheless, I found quite a few guides how to leverage templates worth sharing:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;http://www.tarantsov.com/eclipse/templates/&quot; class=&quot;bare&quot;&gt;http://www.tarantsov.com/eclipse/templates/&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;http://eclipse.dzone.com/news/effective-eclipse-custom-templ&quot; class=&quot;bare&quot;&gt;http://eclipse.dzone.com/news/effective-eclipse-custom-templ&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;A second try was a Fast Code Eclipse plugin (which you can find here: &lt;a href=&quot;http://fast-code.sourceforge.net/&quot; class=&quot;bare&quot;&gt;http://fast-code.sourceforge.net/&lt;/a&gt;). Honestly speaking, it’s a little bit overcomplicated and I’d be rather consider something simpler (Eclipse Code Templates with dynamic fields – maybe I’d write something like that at some point). Nonetheless, Fast Code works like this:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;install plugin&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;go to Window &amp;gt; Preferences &amp;gt; Fast Code Preferences &amp;gt; Template Preferences&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;pick up one (I’ve chosen the first one: Template Instance of Class)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;set “Number Required Classes” to 1, “Allowed File Extension” to java, “Required Getter Setter” to None and paste this in the template body:&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&quot;listingblock&quot;&gt;
&lt;div class=&quot;content&quot;&gt;
&lt;pre class=&quot;highlightjs highlight&quot;&gt;&lt;code class=&quot;language-velocity&quot; data-lang=&quot;velocity&quot;&gt;private ${class_name}(Builder builder) {
#foreach ($field in ${fields})
   this.${field.name} = builder.${field.name};
#end
}

public static class Builder {
#foreach ($field in ${fields})
   private ${field.type} ${field.name};
#end

#foreach ($field in ${fields})
   public Builder with${field.getter.substring(3)}(${field.type} ${field.name}) {
       this.${field.name} = ${field.name};
       return this;
   }
#end

public ${class_name} build() {
           return new ${class_name}(this);
       }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Builders in action work like this: create a new class (like the aforementioned Person, with all intended fields) and run your template:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;ulist&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Fast Code &amp;gt; Create New Snippet (or press Shift + Ctrl + Alt + T)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Pick up “Instance of Class”&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Choose the class&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Pick up fields to be used by the builder.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Format your code (Shift + Ctrl + F).&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;Works like a charm! I know that it does not as the most straightforward activity, but trust me – it really improved my productivity and improved the code quality (no more typos). I’m also aware that I’m using a tiny fraction of Fast Code functionality – but that’s a fraction I was really keen on.&lt;/p&gt;
&lt;/div&gt;</description>
        <pubDate>Wed, 10 Nov 2010 00:00:00 +0000</pubDate>
        <link>http://jakub.marchwicki.pl/posts/2010/11/10/building-pojo-in-elegant-way/</link>
        <guid isPermaLink="true">http://jakub.marchwicki.pl/posts/2010/11/10/building-pojo-in-elegant-way/</guid>
        
        
        <category>posts</category>
        
      </item>
    
  </channel>
</rss>
